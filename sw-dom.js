document.addEventListener("DOMContentLoaded",(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&(sessionStorage.getItem("updated")?(sessionStorage.removeItem("updated"),console.log("更新成功")):("update",navigator.serviceWorker.controller.postMessage("update")),navigator.serviceWorker.addEventListener("message",(e=>{const t=e.data;switch(t.type){case"update":const e=t.update;if(!e)break;sessionStorage.setItem("updated","1"),window.Pjax?.isSupported()?Promise.all(e.map((e=>e.endsWith(".js")||e.endsWith(".css")?(e=>new Promise((t=>{const o=e.endsWith("js")?"script":"link",r=4===o.length?"href":"src";for(let s of document.querySelectorAll(o)){const a=s[r];if(e.length>a?e.endsWith(a):a.endsWith(e)){const e=document.createElement(o),r=s.text||s.textContent||s.innerHTML||"";return Array.from(s.attributes).forEach((t=>e.setAttribute(t.name,t.value))),e.appendChild(document.createTextNode(r)),s.parentNode.replaceChildren(e,s),t(!0)}}t(!1)})))(e):Promise.resolve()))).then((()=>location.reload())):location.reload();break;case"escape":sessionStorage.setItem("updated","1"),location.reload()}})))}));