<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡) | äº‘é‡æœªæ™š</title><meta name="keywords" content="JVM,ä¼˜åŒ–"><meta name="author" content="äº‘å°‘"><meta name="copyright" content="äº‘å°‘"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)"><meta name="application-name" content="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#ffffff"><meta name="description" content="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡) master ï¼Œè¿™æ˜¯æˆ‘çš„å°ç«™,æ¬¢è¿è®¿é—®å“¦~~  æœ¬ç« ä»‹ç»å¯¼è‡´GCæ€§èƒ½é—®é¢˜çš„å…¸å‹æƒ…å†µã€‚ç›¸å…³ç¤ºä¾‹éƒ½æ¥æºäºç”Ÿäº§ç¯å¢ƒ, ä¸ºæ¼”ç¤ºéœ€è¦åšäº†ä¸€å®šç¨‹åº¦çš„ç²¾ç®€ã€‚ è¯´æ˜: Allocation Rate, ç¿»è¯‘ä¸ºåˆ†é…é€Ÿç‡, è€Œä¸æ˜¯åˆ†é…ç‡; å› ä¸ºä¸æ˜¯ç™¾åˆ†æ¯”,è€Œæ˜¯å•ä½æ—¶é—´å†…åˆ†é…çš„é‡; åŒç†, Promotion Rate ç¿»è¯‘ä¸º æå‡é€Ÿç‡; æ‚¨åº”è¯¥å·²ç»é˜…è¯»äº†å‰é¢çš„ç« èŠ‚: é«˜åˆ†"><meta property="og:type" content="article"><meta property="og:title" content="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)"><meta property="og:url" content="https://hexo.tryrun.top/posts/727d80c8.html"><meta property="og:site_name" content="äº‘é‡æœªæ™š"><meta property="og:description" content="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡) master ï¼Œè¿™æ˜¯æˆ‘çš„å°ç«™,æ¬¢è¿è®¿é—®å“¦~~  æœ¬ç« ä»‹ç»å¯¼è‡´GCæ€§èƒ½é—®é¢˜çš„å…¸å‹æƒ…å†µã€‚ç›¸å…³ç¤ºä¾‹éƒ½æ¥æºäºç”Ÿäº§ç¯å¢ƒ, ä¸ºæ¼”ç¤ºéœ€è¦åšäº†ä¸€å®šç¨‹åº¦çš„ç²¾ç®€ã€‚ è¯´æ˜: Allocation Rate, ç¿»è¯‘ä¸ºåˆ†é…é€Ÿç‡, è€Œä¸æ˜¯åˆ†é…ç‡; å› ä¸ºä¸æ˜¯ç™¾åˆ†æ¯”,è€Œæ˜¯å•ä½æ—¶é—´å†…åˆ†é…çš„é‡; åŒç†, Promotion Rate ç¿»è¯‘ä¸º æå‡é€Ÿç‡; æ‚¨åº”è¯¥å·²ç»é˜…è¯»äº†å‰é¢çš„ç« èŠ‚: é«˜åˆ†"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cn.bing.com/th?id=OHR.MarigoldsLosMuertos_EN-US5597948262_UHD.jpg"><meta property="article:published_time" content="2019-01-31T11:12:48.000Z"><meta property="article:modified_time" content="2022-05-18T10:53:58.000Z"><meta property="article:author" content="äº‘å°‘"><meta property="article:tag" content="JVM"><meta property="article:tag" content="ä¼˜åŒ–"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cn.bing.com/th?id=OHR.MarigoldsLosMuertos_EN-US5597948262_UHD.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://hexo.tryrun.top/posts/727d80c8"><link rel="preconnect" href="//npm.elemecdn.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://npm.elemecdn.com/@fortawesome/fontawesome-free@6.3.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/@fancyapps/ui@4.0.31/dist/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",friends_vue_info:{apiurl:"https://friends.tryrun.top/"},navMusic:!0,changeMainColorPost:void 0,algolia:{appId:"T5VW6VDYLS",apiKey:"227bcb041816af13cb1698db15a8ac89",indexName:"hexo-blog",hits:{per_page:6},languages:{input_placeholder:"é”®å…¥åæŒ‰ä¸‹å›è½¦æœç´¢ï¼",hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç®€",rightMenuMsgToTraditionalChinese:"è½¬ä¸ºç¹ä½“",rightMenuMsgToSimplifiedChinese:"è½¬ä¸ºç®€ä½“"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“",cht_to_chs:"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“",day_to_night:"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#3b70fc",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://npm.elemecdn.com/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://npm.elemecdn.com/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)",isPost:!0,isHome:!1,isHighlightShrink:!0,isToc:!0,postUpdate:"2022-05-18 18:53:58"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,n={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(n))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)})),e.getCSS=(e,t=!1)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,n=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!o&&!a&&!n;if(void 0===t){if(a)activateLightMode();else if(o)activateDarkMode();else if(n||c){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((function(e){void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/1.css?1"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="äº‘é‡æœªæ™š" type="application/atom+xml"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-right-bg"></div><div class="loading-bg"><div class="loading-image-dot"></div><div class="loading-font">loading...</div><div id="loading-percentage">0%</div></div></div><script>const loadingPercentage=document.getElementById("loading-percentage");let loadingPercentageTimer=setInterval((function(){var e=document.querySelector(".pace-progress");if(e){var t=e.getAttribute("data-progress-text");t!==loadingPercentage.textContent&&(loadingPercentage.textContent=t,"100%"===t&&clearInterval(loadingPercentageTimer))}}),100);const preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded"),Pace.restart()},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()})),document.addEventListener("pjax:send",(()=>{preloader.initLoading()})),document.addEventListener("pjax:complete",(()=>{preloader.endLoading()}))</script><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/progress_bar/progress_bar.css"><script async src="https://npm.elemecdn.com/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div id="web_box"><div id="web_container"><div id="menu-mask"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">ç½‘é¡µ</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.anheyu.com/" title="åšå®¢" target="_blank"><img class="back-menu-item-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.ico" alt="åšå®¢"><span class="back-menu-item-text">åšå®¢</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">é¡¹ç›®</div><div class="back-menu-list"><a class="back-menu-item" href="https://image.anheyu.com/" title="å®‰çŸ¥é±¼å›¾åºŠ" target="_blank"><img class="back-menu-item-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="å®‰çŸ¥é±¼å›¾åºŠ"><span class="back-menu-item-text">å®‰çŸ¥é±¼å›¾åºŠ</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">äº‘é‡æœªæ™š</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>æœ›å››æ–¹</span></a><ul class="menus_item_child" style="left:-127px"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>å½’åæ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>å½’å››ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>ä¹¦ä¸­ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-fw fas fa-chart-bar faa-tada"></i> <span>ç»Ÿè®¡</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>å‹é“¾</span></a><ul class="menus_item_child" style="left:-79px"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>å››æ–¹å¥½å‹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>æˆ‘çš„</span></a><ul class="menus_item_child" style="left:-175px"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>éŸ³ä¹é¦†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i> <span>è¿½ç•ªé¡µ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i> <span>åˆ¹é‚£é—´</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i> <span>å°ç©ºè°ƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="fas fa-heart faa-tada"></i> <span>æˆ‘çš„è£…å¤‡</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>å…³äº</span></a><ul class="menus_item_child" style="left:-127px"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i> <span>éšä¾¿é€›é€›</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/disclaimer/"><i class="fas fa-heart faa-tada"></i> <span>å…è´£å£°æ˜</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="éšæœºå‰å¾€ä¸€ä¸ªå¼€å¾€é¡¹ç›®ç½‘ç«™"><a class="site-page" onclick="anzhiyu.totraveling()" title="éšæœºå‰å¾€ä¸€ä¸ªå¼€å¾€é¡¹ç›®ç½‘ç«™" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºå‰å¾€ä¸€ä¸ªæ–‡ç« " href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="æœç´¢ğŸ”" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i> <span>æœç´¢</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="ä¸­æ§å°" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wxpay.webp" target="_blank"><img class="post-qr-code-img" alt="wechat" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wxpay.webp"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" alt="alipay" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.webp"></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments" onclick="anzhiyu.hideConsole()"><div class="card-content"><div class="author-content-item-tips">äº’åŠ¨</div><span class="author-content-item-title"><span>æœ€æ–°è¯„è®º</span></span></div><div class="aside-list"><span>æ­£åœ¨åŠ è½½ä¸­...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags" onclick="anzhiyu.hideConsole()"><div class="card-content"><div class="author-content-item-tips">éŸ³ä¹</div><span class="author-content-item-title">çµé­‚çš„ç¢°æ’ğŸ’¥</span></div></div><div class="console-card history" onclick="anzhiyu.hideConsole()"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>æ–‡ç« </span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>å½’æ¡£</span><a class="card-more-btn" href="/archives/" title="æŸ¥çœ‹æ›´å¤š"><i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">å…­æœˆ 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">äº”æœˆ 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/09/"><span class="card-archive-list-date">ä¹æœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">41</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/08/"><span class="card-archive-list-date">å…«æœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">46</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/07/"><span class="card-archive-list-date">ä¸ƒæœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">41</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/06/"><span class="card-archive-list-date">å…­æœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">30</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/05/"><span class="card-archive-list-date">äº”æœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">41</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/04/"><span class="card-archive-list-date">å››æœˆ 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">35</span><span>ç¯‡</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" onclick="anzhiyu.switchDarkMode()" title="æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="è¾¹æ æ˜¾ç¤ºæ§åˆ¶"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="çƒ­è¯„å¼€å…³"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="éŸ³ä¹å¼€å…³"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="å¿«æ·é”®å¼€å…³"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">åŸåˆ›</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/JVM/" tabindex="-1"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> JVM</span></a><a class="article-meta__tags" href="/tags/%E4%BC%98%E5%8C%96/" tabindex="-1"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> ä¼˜åŒ–</span></a></span></div></div><h1 class="post-title">å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2019-01-31T11:12:48.000Z" title="å‘è¡¨äº 2019-01-31 19:12:48">2019-01-31</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-05-18T10:53:58.000Z" title="æ›´æ–°äº 2022-05-18 18:53:58">2022-05-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="æ–‡ç« å­—æ•°"></i><span class="post-meta-label" title="æ–‡ç« å­—æ•°">å­—æ•°æ€»è®¡:</span><span class="word-count" title="æ–‡ç« å­—æ•°">7.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="é˜…è¯»æ—¶é•¿"></i><span class="post-meta-label" title="é˜…è¯»æ—¶é•¿">é˜…è¯»æ—¶é•¿:</span><span>28åˆ†é’Ÿ</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="é˜…è¯»é‡">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"></span><span class="post-meta-position" title="ä½œè€…IPå±åœ°ä¸ºæ¹–åŒ—"><i class="anzhiyufont anzhiyu-icon-location-dot"></i> æ¹–åŒ—</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cn.bing.com/th?id=OHR.MoonJellyDay_EN-US5774626244_UHD.jpg"></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="å…«ã€GC-æ€§èƒ½ä¼˜åŒ–-â€“-GC-è°ƒä¼˜-å®æˆ˜ç¯‡"><a href="#å…«ã€GC-æ€§èƒ½ä¼˜åŒ–-â€“-GC-è°ƒä¼˜-å®æˆ˜ç¯‡" class="headerlink" title="å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)"></a>å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)</h1><blockquote><p>master ï¼Œè¿™æ˜¯æˆ‘çš„<a target="_blank" rel="noopener" href="https://www.tryrun.top/">å°ç«™</a>,æ¬¢è¿è®¿é—®å“¦~~</p></blockquote><p>æœ¬ç« ä»‹ç»å¯¼è‡´GCæ€§èƒ½é—®é¢˜çš„å…¸å‹æƒ…å†µã€‚ç›¸å…³ç¤ºä¾‹éƒ½æ¥æºäºç”Ÿäº§ç¯å¢ƒ, ä¸ºæ¼”ç¤ºéœ€è¦åšäº†ä¸€å®šç¨‹åº¦çš„ç²¾ç®€ã€‚</p><p><strong>è¯´æ˜</strong>: <code>Allocation Rate</code>, ç¿»è¯‘ä¸º<code>åˆ†é…é€Ÿç‡</code>, è€Œä¸æ˜¯åˆ†é…ç‡; å› ä¸ºä¸æ˜¯ç™¾åˆ†æ¯”,è€Œæ˜¯å•ä½æ—¶é—´å†…åˆ†é…çš„é‡;</p><p>åŒç†, <code>Promotion Rate</code> ç¿»è¯‘ä¸º <code>æå‡é€Ÿç‡</code>;</p><p>æ‚¨åº”è¯¥å·²ç»é˜…è¯»äº†å‰é¢çš„ç« èŠ‚:</p><h2 id="é«˜åˆ†é…é€Ÿç‡-High-Allocation-Rate"><a href="#é«˜åˆ†é…é€Ÿç‡-High-Allocation-Rate" class="headerlink" title="é«˜åˆ†é…é€Ÿç‡(High Allocation Rate)"></a>é«˜åˆ†é…é€Ÿç‡(High Allocation Rate)</h2><p>åˆ†é…é€Ÿç‡(<code>Allocation rate</code>)è¡¨ç¤ºå•ä½æ—¶é—´å†…åˆ†é…çš„å†…å­˜é‡ã€‚é€šå¸¸ä½¿ç”¨ <code>MB/sec</code>ä½œä¸ºå•ä½, ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>PB/year</code> ç­‰ã€‚</p><p>åˆ†é…é€Ÿç‡è¿‡é«˜å°±ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚åœ¨JVMä¸­ä¼šå¯¼è‡´å·¨å¤§çš„GCå¼€é”€ã€‚</p><h3 id="å¦‚ä½•æµ‹é‡åˆ†é…é€Ÿç‡"><a href="#å¦‚ä½•æµ‹é‡åˆ†é…é€Ÿç‡" class="headerlink" title="å¦‚ä½•æµ‹é‡åˆ†é…é€Ÿç‡?"></a>å¦‚ä½•æµ‹é‡åˆ†é…é€Ÿç‡?</h3><p>æŒ‡å®šJVMå‚æ•°: <code>-XX:+PrintGCDetails -XX:+PrintGCTimeStamps</code> , é€šè¿‡GCæ—¥å¿—æ¥è®¡ç®—åˆ†é…é€Ÿç‡. GCæ—¥å¿—å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0.291: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 33280K-&gt;5088K(38400K)] </span><br><span class="line">        33280K-&gt;24360K(125952K), 0.0365286 secs] </span><br><span class="line">    [Times: user=0.11 sys=0.02, real=0.04 secs] </span><br><span class="line">0.446: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 38368K-&gt;5120K(71680K)] </span><br><span class="line">        57640K-&gt;46240K(159232K), 0.0456796 secs] </span><br><span class="line">    [Times: user=0.15 sys=0.02, real=0.04 secs] </span><br><span class="line">0.829: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 71680K-&gt;5120K(71680K)] </span><br><span class="line">        112800K-&gt;81912K(159232K), 0.0861795 secs] </span><br><span class="line">    [Times: user=0.23 sys=0.03, real=0.09 secs]</span><br></pre></td></tr></table></figure><p>è®¡ç®— <code>ä¸Šä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å</code>,ä¸<code>ä¸‹ä¸€æ¬¡GCå¼€å§‹ä¹‹å‰</code>çš„å¹´è½»ä»£ä½¿ç”¨é‡, ä¸¤è€…çš„å·®å€¼é™¤ä»¥æ—¶é—´,å°±æ˜¯åˆ†é…é€Ÿç‡ã€‚ é€šè¿‡ä¸Šé¢çš„æ—¥å¿—, å¯ä»¥è®¡ç®—å‡ºä»¥ä¸‹ä¿¡æ¯:</p><ul><li>JVMå¯åŠ¨ä¹‹å <code>291ms</code>, å…±åˆ›å»ºäº† <code>33,280 KB</code> çš„å¯¹è±¡ã€‚ ç¬¬ä¸€æ¬¡ Minor GC(å°å‹GC) å®Œæˆå, å¹´è½»ä»£ä¸­è¿˜æœ‰ <code>5,088 KB</code> çš„å¯¹è±¡å­˜æ´»ã€‚</li><li>åœ¨å¯åŠ¨ä¹‹å <code>446 ms</code>, å¹´è½»ä»£çš„ä½¿ç”¨é‡å¢åŠ åˆ° <code>38,368 KB</code>, è§¦å‘ç¬¬äºŒæ¬¡GC, å®Œæˆåå¹´è½»ä»£çš„ä½¿ç”¨é‡å‡å°‘åˆ° <code>5,120 KB</code>ã€‚</li><li>åœ¨å¯åŠ¨ä¹‹å <code>829 ms</code>, å¹´è½»ä»£çš„ä½¿ç”¨é‡ä¸º <code>71,680 KB</code>, GCåå˜ä¸º <code>5,120 KB</code>ã€‚</li></ul><p>å¯ä»¥é€šè¿‡å¹´è½»ä»£çš„ä½¿ç”¨é‡æ¥è®¡ç®—åˆ†é…é€Ÿç‡, å¦‚ä¸‹è¡¨æ‰€ç¤º:</p><table><thead><tr><th align="center"><strong>Event</strong></th><th align="center"><strong>Time</strong></th><th align="center"><strong>Young before</strong></th><th align="center"><strong>Young after</strong></th><th align="center"><strong>Allocated during</strong></th><th align="center"><strong>Allocation rate</strong></th></tr></thead><tbody><tr><td align="center">1st GC</td><td align="center">291ms</td><td align="center">33,280KB</td><td align="center">5,088KB</td><td align="center">33,280KB</td><td align="center"><strong>114MB&#x2F;sec</strong></td></tr><tr><td align="center">2nd GC</td><td align="center">446ms</td><td align="center">38,368KB</td><td align="center">5,120KB</td><td align="center">33,280KB</td><td align="center"><strong>215MB&#x2F;sec</strong></td></tr><tr><td align="center">3rd GC</td><td align="center">829ms</td><td align="center">71,680KB</td><td align="center">5,120KB</td><td align="center">66,560KB</td><td align="center"><strong>174MB&#x2F;sec</strong></td></tr><tr><td align="center">Total</td><td align="center">829ms</td><td align="center">N&#x2F;A</td><td align="center">N&#x2F;A</td><td align="center">133,120KB</td><td align="center"><strong>161MB&#x2F;sec</strong></td></tr></tbody></table><p>é€šè¿‡è¿™äº›ä¿¡æ¯å¯ä»¥çŸ¥é“, åœ¨æµ‹é‡æœŸé—´, è¯¥ç¨‹åºçš„å†…å­˜åˆ†é…é€Ÿç‡ä¸º <code>161 MB/sec</code>ã€‚</p><h3 id="åˆ†é…é€Ÿç‡çš„æ„ä¹‰"><a href="#åˆ†é…é€Ÿç‡çš„æ„ä¹‰" class="headerlink" title="åˆ†é…é€Ÿç‡çš„æ„ä¹‰"></a>åˆ†é…é€Ÿç‡çš„æ„ä¹‰</h3><p>åˆ†é…é€Ÿç‡çš„å˜åŒ–,ä¼šå¢åŠ æˆ–é™ä½GCæš‚åœçš„é¢‘ç‡, ä»è€Œå½±å“ååé‡ã€‚ ä½†åªæœ‰å¹´è½»ä»£çš„ <a target="_blank" rel="noopener" href="http://blog.csdn.net/renfufei/article/details/54144385#t9">minor GC</a> å—åˆ†é…é€Ÿç‡çš„å½±å“, è€å¹´ä»£GCçš„é¢‘ç‡å’ŒæŒç»­æ—¶é—´ä¸å— <strong>åˆ†é…é€Ÿç‡</strong>(<code>allocation rate</code>)çš„ç›´æ¥å½±å“, è€Œæ˜¯å—åˆ° <strong>æå‡é€Ÿç‡</strong>(<code>promotion rate</code>)çš„å½±å“, è¯·å‚è§ä¸‹æ–‡ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åªå…³å¿ƒ <a target="_blank" rel="noopener" href="http://blog.csdn.net/renfufei/article/details/54144385#t9">Minor GC</a> æš‚åœ, æŸ¥çœ‹å¹´è½»ä»£çš„3ä¸ªå†…å­˜æ± ã€‚å› ä¸ºå¯¹è±¡åœ¨ <a target="_blank" rel="noopener" href="http://blog.csdn.net/renfufei/article/details/54144385#t3">EdenåŒº</a>åˆ†é…, æ‰€ä»¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ Eden åŒºçš„å¤§å°å’Œåˆ†é…é€Ÿç‡çš„å…³ç³». çœ‹çœ‹å¢åŠ  Eden åŒºçš„å®¹é‡, èƒ½ä¸èƒ½å‡å°‘ Minor GC æš‚åœæ¬¡æ•°, ä»è€Œä½¿ç¨‹åºèƒ½å¤Ÿç»´æŒæ›´é«˜çš„åˆ†é…é€Ÿç‡ã€‚</p><p>ç»è¿‡æˆ‘ä»¬çš„å®éªŒ, é€šè¿‡å‚æ•° <code>-XX:NewSize</code>ã€ <code>-XX:MaxNewSize</code> ä»¥åŠ <code>-XX:SurvivorRatio</code> è®¾ç½®ä¸åŒçš„ Eden ç©ºé—´, è¿è¡ŒåŒä¸€ç¨‹åºæ—¶, å¯ä»¥å‘ç°:</p><ul><li>Eden ç©ºé—´ä¸º <code>100 MB</code> æ—¶, åˆ†é…é€Ÿç‡ä½äº <code>100 MB/ç§’</code>ã€‚</li><li>å°† Eden åŒºå¢å¤§ä¸º <code>1 GB</code>, åˆ†é…é€Ÿç‡ä¹Ÿéšä¹‹å¢é•¿,å¤§çº¦ç­‰äº <code>200 MB/ç§’</code>ã€‚</li></ul><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·? â€”â€” å› ä¸ºå‡å°‘GCæš‚åœ,å°±ç­‰ä»·äºå‡å°‘äº†ä»»åŠ¡çº¿ç¨‹çš„åœé¡¿ï¼Œå°±å¯ä»¥åšæ›´å¤šå·¥ä½œ, ä¹Ÿå°±åˆ›å»ºäº†æ›´å¤šå¯¹è±¡, æ‰€ä»¥å¯¹åŒä¸€åº”ç”¨æ¥è¯´, åˆ†é…é€Ÿç‡è¶Šé«˜è¶Šå¥½ã€‚</p><p>åœ¨å¾—å‡º â€œEdenåŒºè¶Šå¤§è¶Šå¥½â€ è¿™ä¸ªç»“è®ºå‰, æˆ‘ä»¬æ³¨æ„åˆ°, åˆ†é…é€Ÿç‡å¯èƒ½ä¼š,ä¹Ÿå¯èƒ½ä¸ä¼šå½±å“ç¨‹åºçš„å®é™…ååé‡ã€‚ ååé‡å’Œåˆ†é…é€Ÿç‡æœ‰ä¸€å®šå…³ç³», å› ä¸ºåˆ†é…é€Ÿç‡ä¼šå½±å“ minor GC æš‚åœ, ä½†å¯¹äºæ€»ä½“ååé‡çš„å½±å“, è¿˜è¦è€ƒè™‘ Major GC(å¤§å‹GC)æš‚åœ, è€Œä¸”ååé‡çš„å•ä½ä¸æ˜¯ <code>MB/ç§’</code>ï¼Œ è€Œæ˜¯ç³»ç»Ÿæ‰€å¤„ç†çš„ä¸šåŠ¡é‡ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/Boxing.java">Demoç¨‹åº</a>ã€‚å‡è®¾ç³»ç»Ÿè¿æ¥äº†ä¸€ä¸ªå¤–éƒ¨çš„æ•°å­—ä¼ æ„Ÿå™¨ã€‚åº”ç”¨é€šè¿‡ä¸“æœ‰çº¿ç¨‹, ä¸æ–­åœ°è·å–ä¼ æ„Ÿå™¨çš„å€¼,(æ­¤å¤„ä½¿ç”¨éšæœºæ•°æ¨¡æ‹Ÿ), å…¶ä»–çº¿ç¨‹ä¼šè°ƒç”¨ <code>processSensorValue()</code> æ–¹æ³•, ä¼ å…¥ä¼ æ„Ÿå™¨çš„å€¼æ¥æ‰§è¡ŒæŸäº›æ“ä½œ, :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class BoxingFailure &#123;</span><br><span class="line">  private static volatile Double sensorValue;</span><br><span class="line"></span><br><span class="line">  private static void readSensor() &#123;</span><br><span class="line">    while(true) sensorValue = Math.random();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private static void processSensorValue(Double value) &#123;</span><br><span class="line">    if(value != null) &#123;</span><br><span class="line">      //...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚åŒç±»åæ‰€ç¤º, è¿™ä¸ªDemoæ˜¯æ¨¡æ‹Ÿ boxing çš„ã€‚ä¸ºäº† null å€¼åˆ¤æ–­, ä½¿ç”¨çš„æ˜¯åŒ…è£…ç±»å‹ <code>Double</code>ã€‚ ç¨‹åºåŸºäºä¼ æ„Ÿå™¨çš„æœ€æ–°å€¼è¿›è¡Œè®¡ç®—, ä½†ä»ä¼ æ„Ÿå™¨å–å€¼æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œ, æ‰€ä»¥é‡‡ç”¨äº†å¼‚æ­¥æ–¹å¼ï¼š ä¸€ä¸ªçº¿ç¨‹ä¸æ–­è·å–æ–°å€¼, è®¡ç®—çº¿ç¨‹åˆ™ç›´æ¥ä½¿ç”¨æš‚å­˜çš„æœ€æ–°å€¼, ä»è€Œé¿å…åŒæ­¥ç­‰å¾…ã€‚</p><p><a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/Boxing.java">Demo ç¨‹åº</a>åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­, ç”±äºåˆ†é…é€Ÿç‡å¤ªå¤§è€Œå—åˆ°GCçš„å½±å“ã€‚ä¸‹ä¸€èŠ‚å°†ç¡®è®¤é—®é¢˜, å¹¶ç»™å‡ºè§£å†³åŠæ³•ã€‚</p><h3 id="é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“"><a href="#é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“" class="headerlink" title="é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“"></a>é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥æ£€æŸ¥ç¨‹åºçš„ååé‡æ˜¯å¦é™ä½ã€‚å¦‚æœåˆ›å»ºäº†è¿‡å¤šçš„ä¸´æ—¶å¯¹è±¡, minor GCçš„æ¬¡æ•°å°±ä¼šå¢åŠ ã€‚å¦‚æœå¹¶å‘è¾ƒå¤§, åˆ™GCå¯èƒ½ä¼šä¸¥é‡å½±å“ååé‡ã€‚</p><p>é‡åˆ°è¿™ç§æƒ…å†µæ—¶, GCæ—¥å¿—å°†ä¼šåƒä¸‹é¢è¿™æ ·ï¼Œå½“ç„¶è¿™æ˜¯ä¸Šé¢çš„<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/Boxing.java">ç¤ºä¾‹ç¨‹åº</a> äº§ç”Ÿçš„GCæ—¥å¿—ã€‚ JVMå¯åŠ¨å‚æ•°ä¸º <code>-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xmx32m</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">2.808: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003076 secs]</span><br><span class="line">2.819: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003079 secs]</span><br><span class="line">2.830: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0002968 secs]</span><br><span class="line">2.842: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003374 secs]</span><br><span class="line">2.853: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0004672 secs]</span><br><span class="line">2.864: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003371 secs]</span><br><span class="line">2.875: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003214 secs]</span><br><span class="line">2.886: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003374 secs]</span><br><span class="line">2.896: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 9760K-&gt;32K(10240K)], 0.0003588 secs]</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ minor GC çš„é¢‘ç‡å¤ªé«˜äº†ã€‚è¿™è¯´æ˜åˆ›å»ºäº†å¤§é‡çš„å¯¹è±¡ã€‚å¦å¤–, å¹´è½»ä»£åœ¨ GC ä¹‹åçš„ä½¿ç”¨é‡åˆå¾ˆä½, ä¹Ÿæ²¡æœ‰ full GC å‘ç”Ÿã€‚ ç§ç§è¿¹è±¡è¡¨æ˜, GCå¯¹ååé‡é€ æˆäº†ä¸¥é‡çš„å½±å“ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹,åªè¦å¢åŠ å¹´è½»ä»£çš„å¤§å°, å³å¯é™ä½åˆ†é…é€Ÿç‡è¿‡é«˜æ‰€é€ æˆçš„å½±å“ã€‚å¢åŠ å¹´è½»ä»£ç©ºé—´å¹¶ä¸ä¼šé™ä½åˆ†é…é€Ÿç‡, ä½†æ˜¯ä¼šå‡å°‘GCçš„é¢‘ç‡ã€‚å¦‚æœæ¯æ¬¡GCååªæœ‰å°‘é‡å¯¹è±¡å­˜æ´», minor GC çš„æš‚åœæ—¶é—´å°±ä¸ä¼šæ˜æ˜¾å¢åŠ ã€‚</p><p>è¿è¡Œ <a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/Boxing.java">ç¤ºä¾‹ç¨‹åº</a> æ—¶, å¢åŠ å †å†…å­˜å¤§å°,(åŒæ—¶ä¹Ÿå°±å¢å¤§äº†å¹´è½»ä»£çš„å¤§å°), ä½¿ç”¨çš„JVMå‚æ•°ä¸º <code>-Xmx64m</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2.808: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 20512K-&gt;32K(20992K)], 0.0003748 secs]</span><br><span class="line">2.831: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 20512K-&gt;32K(20992K)], 0.0004538 secs]</span><br><span class="line">2.855: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 20512K-&gt;32K(20992K)], 0.0003355 secs]</span><br><span class="line">2.879: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 20512K-&gt;32K(20992K)], 0.0005592 secs]</span><br></pre></td></tr></table></figure><p>ä½†æœ‰æ—¶å€™å¢åŠ å †å†…å­˜çš„å¤§å°,å¹¶ä¸èƒ½è§£å†³é—®é¢˜ã€‚é€šè¿‡å‰é¢å­¦åˆ°çš„çŸ¥è¯†, æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…åˆ†æå™¨æ‰¾å‡ºå¤§éƒ¨åˆ†åƒåœ¾äº§ç”Ÿçš„ä½ç½®ã€‚å®é™…ä¸Šåœ¨æ­¤ç¤ºä¾‹ä¸­, 99%çš„å¯¹è±¡å±äº <code>Double</code> åŒ…è£…ç±», åœ¨<code>readSensor</code> æ–¹æ³•ä¸­åˆ›å»ºã€‚æœ€ç®€å•çš„ä¼˜åŒ–, å°†åˆ›å»ºçš„ <code>Double</code> å¯¹è±¡æ›¿æ¢ä¸ºåŸç”Ÿç±»å‹ <code>double</code>, è€Œé’ˆå¯¹ null å€¼çš„æ£€æµ‹, å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#NaN">Double.NaN</a> æ¥è¿›è¡Œã€‚ç”±äºåŸç”Ÿç±»å‹ä¸ç®—æ˜¯å¯¹è±¡, ä¹Ÿå°±ä¸ä¼šäº§ç”Ÿåƒåœ¾, å¯¼è‡´GCäº‹ä»¶ã€‚ä¼˜åŒ–ä¹‹å, ä¸åœ¨å †ä¸­åˆ†é…æ–°å¯¹è±¡, è€Œæ˜¯ç›´æ¥è¦†ç›–ä¸€ä¸ªå±æ€§åŸŸå³å¯ã€‚</p><p>å¯¹ç¤ºä¾‹ç¨‹åºè¿›è¡Œ<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/FixedBoxing.java">ç®€å•çš„æ”¹é€ </a>( <a target="_blank" rel="noopener" href="https://gist.github.com/gvsmirnov/0270f0f15f9498e3b655">æŸ¥çœ‹diff</a> ) å, GCæš‚åœåŸºæœ¬ä¸Šå®Œå…¨æ¶ˆé™¤ã€‚æœ‰æ—¶å€™ JVM ä¹Ÿå¾ˆæ™ºèƒ½, ä¼šä½¿ç”¨ é€ƒé€¸åˆ†ææŠ€æœ¯(escape analysis technique) æ¥é¿å…è¿‡åº¦åˆ†é…ã€‚ç®€å•æ¥è¯´,JITç¼–è¯‘å™¨å¯ä»¥é€šè¿‡åˆ†æå¾—çŸ¥, æ–¹æ³•åˆ›å»ºçš„æŸäº›å¯¹è±¡æ°¸è¿œéƒ½ä¸ä¼šâ€œé€ƒå‡ºâ€æ­¤æ–¹æ³•çš„ä½œç”¨åŸŸã€‚è¿™æ—¶å€™å°±ä¸éœ€è¦åœ¨å †ä¸Šåˆ†é…è¿™äº›å¯¹è±¡, ä¹Ÿå°±ä¸ä¼šäº§ç”Ÿåƒåœ¾, æ‰€ä»¥JITç¼–è¯‘å™¨çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µå°±æ˜¯: æ¶ˆé™¤å†…å­˜åˆ†é…ã€‚è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/jit/EscapeAnalysis.java">åŸºå‡†æµ‹è¯•</a> ã€‚</p><h2 id="è¿‡æ—©æå‡-Premature-Promotion"><a href="#è¿‡æ—©æå‡-Premature-Promotion" class="headerlink" title="è¿‡æ—©æå‡(Premature Promotion)"></a>è¿‡æ—©æå‡(Premature Promotion)</h2><p><strong>æå‡é€Ÿç‡</strong>(<code>promotion rate</code>), ç”¨äºè¡¡é‡å•ä½æ—¶é—´å†…ä»å¹´è½»ä»£æå‡åˆ°è€å¹´ä»£çš„æ•°æ®é‡ã€‚ä¸€èˆ¬ä½¿ç”¨ <code>MB/sec</code> ä½œä¸ºå•ä½, å’Œ<code>åˆ†é…é€Ÿç‡</code>ç±»ä¼¼ã€‚</p><p>JVMä¼šå°†é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡ä»å¹´è½»ä»£æå‡åˆ°è€å¹´ä»£ã€‚æ ¹æ®åˆ†ä»£å‡è®¾, å¯èƒ½å­˜åœ¨ä¸€ç§æƒ…å†µ, è€å¹´ä»£ä¸­ä¸ä»…æœ‰å­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡,ä¹Ÿå¯èƒ½æœ‰å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯è¿‡æ—©æå‡ï¼šå¯¹è±¡å­˜æ´»æ—¶é—´è¿˜ä¸å¤Ÿé•¿çš„æ—¶å€™å°±è¢«æå‡åˆ°äº†è€å¹´ä»£ã€‚</p><p>major GC ä¸æ˜¯ä¸ºé¢‘ç¹å›æ”¶è€Œè®¾è®¡çš„, ä½† major GC ç°åœ¨ä¹Ÿè¦æ¸…ç†è¿™äº›ç”Ÿå‘½çŸ­æš‚çš„å¯¹è±¡, å°±ä¼šå¯¼è‡´GCæš‚åœæ—¶é—´è¿‡é•¿ã€‚è¿™ä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„ååé‡ã€‚</p><h3 id="å¦‚ä½•æµ‹é‡æå‡é€Ÿç‡"><a href="#å¦‚ä½•æµ‹é‡æå‡é€Ÿç‡" class="headerlink" title="å¦‚ä½•æµ‹é‡æå‡é€Ÿç‡"></a>å¦‚ä½•æµ‹é‡æå‡é€Ÿç‡</h3><p>å¯ä»¥æŒ‡å®šJVMå‚æ•° <code>-XX:+PrintGCDetails -XX:+PrintGCTimeStamps</code> , é€šè¿‡GCæ—¥å¿—æ¥æµ‹é‡æå‡é€Ÿç‡. JVMè®°å½•çš„GCæš‚åœä¿¡æ¯å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0.291: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 33280K-&gt;5088K(38400K)] </span><br><span class="line">        33280K-&gt;24360K(125952K), 0.0365286 secs] </span><br><span class="line">    [Times: user=0.11 sys=0.02, real=0.04 secs] </span><br><span class="line">0.446: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 38368K-&gt;5120K(71680K)] </span><br><span class="line">        57640K-&gt;46240K(159232K), 0.0456796 secs] </span><br><span class="line">    [Times: user=0.15 sys=0.02, real=0.04 secs] </span><br><span class="line">0.829: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 71680K-&gt;5120K(71680K)] </span><br><span class="line">        112800K-&gt;81912K(159232K), 0.0861795 secs] </span><br><span class="line">    [Times: user=0.23 sys=0.03, real=0.09 secs]</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„æ—¥å¿—å¯ä»¥å¾—çŸ¥ï¼š GCä¹‹å‰å’Œä¹‹åçš„ å¹´è½»ä»£ä½¿ç”¨é‡ä»¥åŠå †å†…å­˜ä½¿ç”¨é‡ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡å·®å€¼ç®—å‡ºè€å¹´ä»£çš„ä½¿ç”¨é‡ã€‚GCæ—¥å¿—ä¸­çš„ä¿¡æ¯å¯ä»¥è¡¨è¿°ä¸º:</p><table><thead><tr><th align="center"><strong>Event</strong></th><th align="center"><strong>Time</strong></th><th align="center"><strong>Young decreased</strong></th><th align="center"><strong>Total decreased</strong></th><th align="center"><strong>Promoted</strong></th><th align="center"><strong>Promotion rate</strong></th></tr></thead><tbody><tr><td align="center"><strong>(äº‹ä»¶)</strong></td><td align="center"><strong>(è€—æ—¶)</strong></td><td align="center"><strong>(å¹´è½»ä»£å‡å°‘)</strong></td><td align="center"><strong>(æ•´ä¸ªå †å†…å­˜å‡å°‘)</strong></td><td align="center"><strong>(æå‡é‡)</strong></td><td align="center"><strong>(æå‡é€Ÿç‡)</strong></td></tr><tr><td align="center">1st GC</td><td align="center">291ms</td><td align="center">28,192K</td><td align="center">8,920K</td><td align="center">19,272K</td><td align="center"><strong>66.2 MB&#x2F;sec</strong></td></tr><tr><td align="center">2nd GC</td><td align="center">446ms</td><td align="center">33,248K</td><td align="center">11,400K</td><td align="center">21,848K</td><td align="center"><strong>140.95 MB&#x2F;sec</strong></td></tr><tr><td align="center">3rd GC</td><td align="center">829ms</td><td align="center">66,560K</td><td align="center">30,888K</td><td align="center">35,672K</td><td align="center"><strong>93.14 MB&#x2F;sec</strong></td></tr><tr><td align="center">Total</td><td align="center">829ms</td><td align="center"></td><td align="center"></td><td align="center">76,792K</td><td align="center"><strong>92.63 MB&#x2F;sec</strong></td></tr></tbody></table><p>æ ¹æ®è¿™äº›ä¿¡æ¯, å°±å¯ä»¥è®¡ç®—å‡ºè§‚æµ‹å‘¨æœŸå†…çš„æå‡é€Ÿç‡ã€‚å¹³å‡æå‡é€Ÿç‡ä¸º <code>92 MB/ç§’</code>, å³°å€¼ä¸º <code>140.95 MB/ç§’</code>ã€‚</p><p>è¯·æ³¨æ„, <strong>åªèƒ½æ ¹æ® minor GC è®¡ç®—æå‡é€Ÿç‡</strong>ã€‚ Full GC çš„æ—¥å¿—ä¸èƒ½ç”¨äºè®¡ç®—æå‡é€Ÿç‡, å› ä¸º major GC ä¼šæ¸…ç†æ‰è€å¹´ä»£ä¸­çš„ä¸€éƒ¨åˆ†å¯¹è±¡ã€‚</p><h3 id="æå‡é€Ÿç‡çš„æ„ä¹‰"><a href="#æå‡é€Ÿç‡çš„æ„ä¹‰" class="headerlink" title="æå‡é€Ÿç‡çš„æ„ä¹‰"></a>æå‡é€Ÿç‡çš„æ„ä¹‰</h3><p>å’Œåˆ†é…é€Ÿç‡ä¸€æ ·, æå‡é€Ÿç‡ä¹Ÿä¼šå½±å“GCæš‚åœçš„é¢‘ç‡ã€‚ä½†åˆ†é…é€Ÿç‡ä¸»è¦å½±å“ <a target="_blank" rel="noopener" href="http://blog.csdn.net/renfufei/article/details/54144385#t8">minor GC</a>, è€Œæå‡é€Ÿç‡åˆ™å½±å“ <a target="_blank" rel="noopener" href="http://blog.csdn.net/renfufei/article/details/54144385#t8">major GC</a> çš„é¢‘ç‡ã€‚æœ‰å¤§é‡çš„å¯¹è±¡æå‡,è‡ªç„¶å¾ˆå¿«å°†è€å¹´ä»£å¡«æ»¡ã€‚ è€å¹´ä»£å¡«å……çš„è¶Šå¿«, åˆ™ major GC äº‹ä»¶çš„é¢‘ç‡å°±ä¼šè¶Šé«˜ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.uuu.ovh/imgs/2022/05/10/61804bf2eb586a91.png" alt="img_1.png"></p><p>æ­¤å‰è¯´è¿‡, full GC é€šå¸¸éœ€è¦æ›´å¤šçš„æ—¶é—´, å› ä¸ºéœ€è¦å¤„ç†æ›´å¤šçš„å¯¹è±¡, è¿˜è¦æ‰§è¡Œç¢ç‰‡æ•´ç†ç­‰é¢å¤–çš„å¤æ‚è¿‡ç¨‹ã€‚</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/PrematurePromotion.java">è¿‡æ—©æå‡çš„ç¤ºä¾‹</a>ã€‚ è¿™ä¸ªç¨‹åºåˆ›å»º&#x2F;è·å–å¤§é‡çš„å¯¹è±¡&#x2F;æ•°æ®,å¹¶æš‚å­˜åˆ°é›†åˆä¹‹ä¸­, è¾¾åˆ°ä¸€å®šæ•°é‡åè¿›è¡Œæ‰¹å¤„ç†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class PrematurePromotion &#123;</span><br><span class="line"></span><br><span class="line">   private static final Collection&lt;byte[]&gt; accumulatedChunks </span><br><span class="line">                = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   private static void onNewChunk(byte[] bytes) &#123;</span><br><span class="line">       accumulatedChunks.add(bytes);</span><br><span class="line"></span><br><span class="line">       if(accumulatedChunks.size() &gt; MAX_CHUNKS) &#123;</span><br><span class="line">           processBatch(accumulatedChunks);</span><br><span class="line">           accumulatedChunks.clear();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ <a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/PrematurePromotion.java">Demo ç¨‹åº</a> å—åˆ°è¿‡æ—©æå‡çš„å½±å“ã€‚ä¸‹æ–‡å°†è¿›è¡ŒéªŒè¯å¹¶ç»™å‡ºè§£å†³åŠæ³•ã€‚</p><h3 id="è¿‡æ—©æå‡çš„å½±å“"><a href="#è¿‡æ—©æå‡çš„å½±å“" class="headerlink" title="è¿‡æ—©æå‡çš„å½±å“"></a>è¿‡æ—©æå‡çš„å½±å“</h3><p>ä¸€èˆ¬æ¥è¯´,è¿‡æ—©æå‡çš„ç—‡çŠ¶è¡¨ç°ä¸ºä»¥ä¸‹å½¢å¼:</p><ul><li>çŸ­æ—¶é—´å†…é¢‘ç¹åœ°æ‰§è¡Œ full GCã€‚</li><li>æ¯æ¬¡ full GC åè€å¹´ä»£çš„ä½¿ç”¨ç‡éƒ½å¾ˆä½, åœ¨10-20%æˆ–ä»¥ä¸‹ã€‚</li><li>æå‡é€Ÿç‡æ¥è¿‘äºåˆ†é…é€Ÿç‡ã€‚</li></ul><p>è¦æ¼”ç¤ºè¿™ç§æƒ…å†µç¨å¾®æœ‰ç‚¹éº»çƒ¦, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ç‰¹æ®Šæ‰‹æ®µ, è®©å¯¹è±¡æå‡åˆ°è€å¹´ä»£çš„å¹´é¾„æ¯”é»˜è®¤æƒ…å†µå°å¾ˆå¤šã€‚æŒ‡å®šGCå‚æ•° <code>-Xmx24m -XX:NewSize=16m -XX:MaxTenuringThreshold=1</code>, è¿è¡Œç¨‹åºä¹‹å,å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„GCæ—¥å¿—:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">2.176: [Full GC (Ergonomics) </span><br><span class="line">        [PSYoungGen: 9216K-&gt;0K(10752K)] </span><br><span class="line">        [ParOldGen: 10020K-&gt;9042K(12288K)] </span><br><span class="line">        19236K-&gt;9042K(23040K), 0.0036840 secs]</span><br><span class="line">2.394: [Full GC (Ergonomics) </span><br><span class="line">        [PSYoungGen: 9216K-&gt;0K(10752K)] </span><br><span class="line">        [ParOldGen: 9042K-&gt;8064K(12288K)] </span><br><span class="line">        18258K-&gt;8064K(23040K), 0.0032855 secs]</span><br><span class="line">2.611: [Full GC (Ergonomics) </span><br><span class="line">        [PSYoungGen: 9216K-&gt;0K(10752K)] </span><br><span class="line">        [ParOldGen: 8064K-&gt;7085K(12288K)] </span><br><span class="line">        17280K-&gt;7085K(23040K), 0.0031675 secs]</span><br><span class="line">2.817: [Full GC (Ergonomics) </span><br><span class="line">        [PSYoungGen: 9216K-&gt;0K(10752K)] </span><br><span class="line">        [ParOldGen: 7085K-&gt;6107K(12288K)] </span><br><span class="line">        16301K-&gt;6107K(23040K), 0.0030652 secs]</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹ä¼¼ä¹ä¸æ˜¯è¿‡æ—©æå‡çš„é—®é¢˜ã€‚äº‹å®ä¸Š,åœ¨æ¯æ¬¡GCä¹‹åè€å¹´ä»£çš„ä½¿ç”¨ç‡ä¼¼ä¹åœ¨å‡å°‘ã€‚ä½†åè¿‡æ¥æƒ³, è¦æ˜¯æ²¡æœ‰å¯¹è±¡æå‡æˆ–è€…æå‡ç‡å¾ˆå°, ä¹Ÿå°±ä¸ä¼šçœ‹åˆ°è¿™ä¹ˆå¤šçš„ Full GC äº†ã€‚</p><p>ç®€å•è§£é‡Šä¸€ä¸‹è¿™é‡Œçš„GCè¡Œä¸º: æœ‰å¾ˆå¤šå¯¹è±¡æå‡åˆ°è€å¹´ä»£, åŒæ—¶è€å¹´ä»£ä¸­ä¹Ÿæœ‰å¾ˆå¤šå¯¹è±¡è¢«å›æ”¶äº†, è¿™å°±é€ æˆäº†è€å¹´ä»£ä½¿ç”¨é‡å‡å°‘çš„å‡è±¡. ä½†äº‹å®æ˜¯å¤§é‡çš„å¯¹è±¡ä¸æ–­åœ°è¢«æå‡åˆ°è€å¹´ä»£, å¹¶è§¦å‘ full GCã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ç®€å•æ¥è¯´, è¦è§£å†³è¿™ç±»é—®é¢˜, éœ€è¦è®©å¹´è½»ä»£å­˜æ”¾å¾—ä¸‹æš‚å­˜çš„æ•°æ®ã€‚æœ‰ä¸¤ç§ç®€å•çš„æ–¹æ³•:</p><p>ä¸€æ˜¯å¢åŠ å¹´è½»ä»£çš„å¤§å°, è®¾ç½®JVMå¯åŠ¨å‚æ•°, ç±»ä¼¼è¿™æ ·: <code>-Xmx64m -XX:NewSize=32m</code>, ç¨‹åºåœ¨æ‰§è¡Œæ—¶, Full GC çš„æ¬¡æ•°è‡ªç„¶ä¼šå‡å°‘å¾ˆå¤š, åªä¼šå¯¹ minor GCçš„æŒç»­æ—¶é—´äº§ç”Ÿå½±å“:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2.251: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 28672K-&gt;3872K(28672K)] </span><br><span class="line">        37126K-&gt;12358K(61440K), 0.0008543 secs]</span><br><span class="line">2.776: [GC (Allocation Failure) </span><br><span class="line">        [PSYoungGen: 28448K-&gt;4096K(28672K)] </span><br><span class="line">        36934K-&gt;16974K(61440K), 0.0033022 secs]</span><br></pre></td></tr></table></figure><p>äºŒæ˜¯å‡å°‘æ¯æ¬¡æ‰¹å¤„ç†çš„æ•°é‡, ä¹Ÿèƒ½å¾—åˆ°ç±»ä¼¼çš„ç»“æœ. è‡³äºé€‰ç”¨å“ªä¸ªæ–¹æ¡ˆ, è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šã€‚åœ¨æŸäº›æƒ…å†µä¸‹, ä¸šåŠ¡é€»è¾‘ä¸å…è®¸å‡å°‘æ‰¹å¤„ç†çš„æ•°é‡, é‚£å°±åªèƒ½å¢åŠ å †å†…å­˜,æˆ–è€…é‡æ–°æŒ‡å®šå¹´è½»ä»£çš„å¤§å°ã€‚</p><p>å¦‚æœéƒ½ä¸å¯è¡Œ, å°±åªèƒ½ä¼˜åŒ–æ•°æ®ç»“æ„, å‡å°‘å†…å­˜æ¶ˆè€—ã€‚ä½†æ€»ä½“ç›®æ ‡ä¾ç„¶æ˜¯ä¸€è‡´çš„: è®©ä¸´æ—¶æ•°æ®èƒ½å¤Ÿåœ¨å¹´è½»ä»£å­˜æ”¾å¾—ä¸‹ã€‚</p><h2 id="Weak-Soft-åŠ-Phantom-å¼•ç”¨"><a href="#Weak-Soft-åŠ-Phantom-å¼•ç”¨" class="headerlink" title="Weak, Soft åŠ Phantom å¼•ç”¨"></a>Weak, Soft åŠ Phantom å¼•ç”¨</h2><p>å¦ä¸€ç±»å½±å“GCçš„é—®é¢˜æ˜¯ç¨‹åºä¸­çš„ <code>non-strong å¼•ç”¨</code>ã€‚è™½ç„¶è¿™ç±»å¼•ç”¨åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥é¿å…å‡ºç° <a target="_blank" rel="noopener" href="https://plumbr.eu/outofmemory"><code>OutOfMemoryError</code></a>, ä½†è¿‡é‡ä½¿ç”¨ä¹Ÿä¼šå¯¹GCé€ æˆä¸¥é‡çš„å½±å“, åè€Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</p><h2 id="å¼±å¼•ç”¨çš„ç¼ºç‚¹"><a href="#å¼±å¼•ç”¨çš„ç¼ºç‚¹" class="headerlink" title="å¼±å¼•ç”¨çš„ç¼ºç‚¹"></a>å¼±å¼•ç”¨çš„ç¼ºç‚¹</h2><p>é¦–å…ˆ, <code>å¼±å¼•ç”¨</code>(<code>weak reference</code>) æ˜¯å¯ä»¥è¢«GCå¼ºåˆ¶å›æ”¶çš„ã€‚å½“åƒåœ¾æ”¶é›†å™¨å‘ç°ä¸€ä¸ªå¼±å¯è¾¾å¯¹è±¡(<code>weakly reachable</code>,å³æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨åªå‰©ä¸‹å¼±å¼•ç”¨) æ—¶, å°±ä¼šå°†å…¶ç½®å…¥ç›¸åº”çš„<code>ReferenceQueue</code> ä¸­, å˜æˆå¯ç»ˆç»“çš„å¯¹è±¡. ä¹‹åå¯èƒ½ä¼šéå†è¿™ä¸ª reference queue, å¹¶æ‰§è¡Œç›¸åº”çš„æ¸…ç†ã€‚å…¸å‹çš„ç¤ºä¾‹æ˜¯æ¸…é™¤ç¼“å­˜ä¸­ä¸å†å¼•ç”¨çš„KEYã€‚</p><p>å½“ç„¶, åœ¨è¿™ä¸ªæ—¶å€™, æˆ‘ä»¬è¿˜å¯ä»¥å°†è¯¥å¯¹è±¡èµ‹å€¼ç»™æ–°çš„å¼ºå¼•ç”¨, åœ¨æœ€åç»ˆç»“å’Œå›æ”¶å‰, GCä¼šå†æ¬¡ç¡®è®¤è¯¥å¯¹è±¡æ˜¯å¦å¯ä»¥å®‰å…¨å›æ”¶ã€‚å› æ­¤, å¼±å¼•ç”¨å¯¹è±¡çš„å›æ”¶è¿‡ç¨‹æ˜¯æ¨ªè·¨å¤šä¸ªGCå‘¨æœŸçš„ã€‚</p><p>å®é™…ä¸Šå¼±å¼•ç”¨ä½¿ç”¨çš„å¾ˆå¤šã€‚å¤§éƒ¨åˆ†ç¼“å­˜æ¡†æ¶(<strong>caching solution</strong>)éƒ½æ˜¯åŸºäºå¼±å¼•ç”¨å®ç°çš„, æ‰€ä»¥è™½ç„¶ä¸šåŠ¡ä»£ç ä¸­æ²¡æœ‰ç›´æ¥ä½¿ç”¨å¼±å¼•ç”¨, ä½†ç¨‹åºä¸­ä¾ç„¶ä¼šå¤§é‡å­˜åœ¨ã€‚</p><p>å…¶æ¬¡, <code>è½¯å¼•ç”¨</code>(soft reference) æ¯”å¼±å¼•ç”¨æ›´éš¾è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶. å›æ”¶è½¯å¼•ç”¨æ²¡æœ‰ç¡®åˆ‡çš„æ—¶é—´ç‚¹, ç”±JVMè‡ªå·±å†³å®š. ä¸€èˆ¬åªä¼šåœ¨å³å°†è€—å°½å¯ç”¨å†…å­˜æ—¶, æ‰ä¼šå›æ”¶è½¯å¼•ç”¨,ä»¥ä½œæœ€åæ‰‹æ®µã€‚è¿™æ„å‘³ç€, å¯èƒ½ä¼šæœ‰æ›´é¢‘ç¹çš„ full GC, æš‚åœæ—¶é—´ä¹Ÿæ¯”é¢„æœŸæ›´é•¿, å› ä¸ºè€å¹´ä»£ä¸­çš„å­˜æ´»å¯¹è±¡ä¼šå¾ˆå¤šã€‚</p><p>æœ€å, ä½¿ç”¨<code>è™šå¼•ç”¨</code>(phantom reference)æ—¶, å¿…é¡»æ‰‹åŠ¨è¿›è¡Œå†…å­˜ç®¡ç†, ä»¥æ ‡è¯†è¿™äº›å¯¹è±¡æ˜¯å¦å¯ä»¥å®‰å…¨åœ°å›æ”¶ã€‚è¡¨é¢ä¸Šçœ‹èµ·æ¥å¾ˆæ­£å¸¸, ä½†å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚ javadoc ä¸­å†™é“:</p><blockquote><p>In order to ensure that a reclaimable object remains so, the referent of a phantom reference may not be retrieved: The get method of a phantom reference always returns null.</p><p>ä¸ºäº†é˜²æ­¢å¯å›æ”¶å¯¹è±¡çš„æ®‹ç•™, è™šå¼•ç”¨å¯¹è±¡ä¸åº”è¯¥è¢«è·å–: <code>phantom reference</code> çš„ <code>get</code> æ–¹æ³•è¿”å›å€¼æ°¸è¿œæ˜¯ <code>null</code>ã€‚</p></blockquote><p>ä»¤äººæƒŠè®¶çš„æ˜¯, å¾ˆå¤šå¼€å‘è€…å¿½ç•¥äº†ä¸‹ä¸€æ®µå†…å®¹(<strong>è¿™æ‰æ˜¯é‡ç‚¹</strong>):</p><blockquote><p>Unlike soft and weak references, phantom references are not automatically cleared by the garbage collector as they are enqueued. An object that is reachable via phantom references will remain so until all such references are cleared or themselves become unreachable.</p><p>ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ä¸åŒ, è™šå¼•ç”¨ä¸ä¼šè¢« GC è‡ªåŠ¨æ¸…é™¤, å› ä¸ºä»–ä»¬è¢«å­˜æ”¾åˆ°é˜Ÿåˆ—ä¸­. é€šè¿‡è™šå¼•ç”¨å¯è¾¾çš„å¯¹è±¡ä¼šç»§ç»­ç•™åœ¨å†…å­˜ä¸­, ç›´åˆ°è°ƒç”¨æ­¤å¼•ç”¨çš„ clear æ–¹æ³•, æˆ–è€…å¼•ç”¨è‡ªèº«å˜ä¸ºä¸å¯è¾¾ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/7/docs/api/java/lang/ref/Reference.html#clear()">clear()</a> æ¥æ¸…é™¤è™šå¼•ç”¨, å¦åˆ™å¯èƒ½ä¼šé€ æˆ <a target="_blank" rel="noopener" href="https://plumbr.eu/outofmemory">OutOfMemoryError</a> è€Œå¯¼è‡´ JVM æŒ‚æ‰. ä½¿ç”¨è™šå¼•ç”¨çš„ç†ç”±æ˜¯, å¯¹äºç”¨ç¼–ç¨‹æ‰‹æ®µæ¥è·Ÿè¸ªæŸä¸ªå¯¹è±¡ä½•æ—¶å˜ä¸ºä¸å¯è¾¾å¯¹è±¡, è¿™æ˜¯å”¯ä¸€çš„å¸¸è§„æ‰‹æ®µã€‚ å’Œè½¯å¼•ç”¨&#x2F;å¼±å¼•ç”¨ä¸åŒçš„æ˜¯, æˆ‘ä»¬ä¸èƒ½å¤æ´»è™šå¯è¾¾(phantom-reachable)å¯¹è±¡ã€‚</p><h2 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>è®©æˆ‘ä»¬çœ‹<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/WeakReferences.java">ä¸€ä¸ªå¼±å¼•ç”¨ç¤ºä¾‹</a>, å…¶ä¸­åˆ›å»ºäº†å¤§é‡çš„å¯¹è±¡, å¹¶åœ¨ minor GC ä¸­å®Œæˆå›æ”¶ã€‚å’Œå‰é¢ä¸€æ ·, ä¿®æ”¹æå‡é˜€å€¼ã€‚ä½¿ç”¨çš„JVMå‚æ•°ä¸º: <code>-Xmx24m -XX:NewSize=16m -XX:MaxTenuringThreshold=1</code> , GCæ—¥å¿—å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2.330: [GC (Allocation Failure)  20933K-&gt;8229K(22528K), 0.0033848 secs]</span><br><span class="line">2.335: [GC (Allocation Failure)  20517K-&gt;7813K(22528K), 0.0022426 secs]</span><br><span class="line">2.339: [GC (Allocation Failure)  20101K-&gt;7429K(22528K), 0.0010920 secs]</span><br><span class="line">2.341: [GC (Allocation Failure)  19717K-&gt;9157K(22528K), 0.0056285 secs]</span><br><span class="line">2.348: [GC (Allocation Failure)  21445K-&gt;8997K(22528K), 0.0041313 secs]</span><br><span class="line">2.354: [GC (Allocation Failure)  21285K-&gt;8581K(22528K), 0.0033737 secs]</span><br><span class="line">2.359: [GC (Allocation Failure)  20869K-&gt;8197K(22528K), 0.0023407 secs]</span><br><span class="line">2.362: [GC (Allocation Failure)  20485K-&gt;7845K(22528K), 0.0011553 secs]</span><br><span class="line">2.365: [GC (Allocation Failure)  20133K-&gt;9501K(22528K), 0.0060705 secs]</span><br><span class="line">2.371: [Full GC (Ergonomics)  9501K-&gt;2987K(22528K), 0.0171452 secs]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, Full GC çš„æ¬¡æ•°å¾ˆå°‘ã€‚ä½†å¦‚æœä½¿ç”¨å¼±å¼•ç”¨æ¥æŒ‡å‘åˆ›å»ºçš„å¯¹è±¡, ä½¿ç”¨JVMå‚æ•° <code>-Dweak.refs=true</code>, åˆ™æƒ…å†µä¼šå‘ç”Ÿæ˜æ˜¾å˜åŒ–. ä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› å¾ˆå¤š, æ¯”å¦‚åœ¨ weak hash map ä¸­å°†å¯¹è±¡ä½œä¸ºKeyçš„æƒ…å†µã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹, ä½¿ç”¨å¼±å¼•ç”¨éƒ½å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹æƒ…å½¢:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2.059: [Full GC (Ergonomics)  20365K-&gt;19611K(22528K), 0.0654090 secs]</span><br><span class="line">2.125: [Full GC (Ergonomics)  20365K-&gt;19711K(22528K), 0.0707499 secs]</span><br><span class="line">2.196: [Full GC (Ergonomics)  20365K-&gt;19798K(22528K), 0.0717052 secs]</span><br><span class="line">2.268: [Full GC (Ergonomics)  20365K-&gt;19873K(22528K), 0.0686290 secs]</span><br><span class="line">2.337: [Full GC (Ergonomics)  20365K-&gt;19939K(22528K), 0.0702009 secs]</span><br><span class="line">2.407: [Full GC (Ergonomics)  20365K-&gt;19995K(22528K), 0.0694095 secs]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, å‘ç”Ÿäº†å¤šæ¬¡ full GC, æ¯”èµ·å‰ä¸€èŠ‚çš„ç¤ºä¾‹, GCæ—¶é—´å¢åŠ äº†ä¸€ä¸ªæ•°é‡çº§! è¿™æ˜¯è¿‡æ—©æå‡çš„å¦ä¸€ä¸ªä¾‹å­, ä½†è¿™æ¬¡æƒ…å†µæ›´åŠ æ£˜æ‰‹. å½“ç„¶,é—®é¢˜çš„æ ¹æºåœ¨äºå¼±å¼•ç”¨ã€‚è¿™äº›ä¸´æ­»çš„å¯¹è±¡, åœ¨æ·»åŠ å¼±å¼•ç”¨ä¹‹å, è¢«æå‡åˆ°äº†è€å¹´ä»£ã€‚ ä½†æ˜¯, ä»–ä»¬ç°åœ¨é™·å…¥å¦ä¸€æ¬¡GCå¾ªç¯ä¹‹ä¸­, æ‰€ä»¥éœ€è¦å¯¹å…¶åšä¸€äº›é€‚å½“çš„æ¸…ç†ã€‚åƒä¹‹å‰ä¸€æ ·, æœ€ç®€å•çš„åŠæ³•æ˜¯å¢åŠ å¹´è½»ä»£çš„å¤§å°, ä¾‹å¦‚æŒ‡å®šJVMå‚æ•°: <code>-Xmx64m -XX:NewSize=32m</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2.328: [GC (Allocation Failure)  38940K-&gt;13596K(61440K), 0.0012818 secs]</span><br><span class="line">2.332: [GC (Allocation Failure)  38172K-&gt;14812K(61440K), 0.0060333 secs]</span><br><span class="line">2.341: [GC (Allocation Failure)  39388K-&gt;13948K(61440K), 0.0029427 secs]</span><br><span class="line">2.347: [GC (Allocation Failure)  38524K-&gt;15228K(61440K), 0.0101199 secs]</span><br><span class="line">2.361: [GC (Allocation Failure)  39804K-&gt;14428K(61440K), 0.0040940 secs]</span><br><span class="line">2.368: [GC (Allocation Failure)  39004K-&gt;13532K(61440K), 0.0012451 secs]</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™, å¯¹è±¡åœ¨ minor GC ä¸­å°±è¢«å›æ”¶äº†ã€‚</p><p>æ›´åçš„æƒ…å†µæ˜¯ä½¿ç”¨è½¯å¼•ç”¨,ä¾‹å¦‚è¿™ä¸ª<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/SoftReferences.java">è½¯å¼•ç”¨ç¤ºä¾‹ç¨‹åº</a>ã€‚å¦‚æœç¨‹åºä¸æ˜¯å³å°†å‘ç”Ÿ <code>OutOfMemoryError</code> , è½¯å¼•ç”¨å¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶. åœ¨ç¤ºä¾‹ç¨‹åºä¸­,ç”¨è½¯å¼•ç”¨æ›¿ä»£å¼±å¼•ç”¨, ç«‹å³å‡ºç°äº†æ›´å¤šçš„ Full GC äº‹ä»¶:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2.162: [Full GC (Ergonomics)  31561K-&gt;12865K(61440K), 0.0181392 secs]</span><br><span class="line">2.184: [GC (Allocation Failure)  37441K-&gt;17585K(61440K), 0.0024479 secs]</span><br><span class="line">2.189: [GC (Allocation Failure)  42161K-&gt;27033K(61440K), 0.0061485 secs]</span><br><span class="line">2.195: [Full GC (Ergonomics)  27033K-&gt;14385K(61440K), 0.0228773 secs]</span><br><span class="line">2.221: [GC (Allocation Failure)  38961K-&gt;20633K(61440K), 0.0030729 secs]</span><br><span class="line">2.227: [GC (Allocation Failure)  45209K-&gt;31609K(61440K), 0.0069772 secs]</span><br><span class="line">2.234: [Full GC (Ergonomics)  31609K-&gt;15905K(61440K), 0.0257689 secs]</span><br></pre></td></tr></table></figure><p>æœ€æœ‰è¶£çš„æ˜¯<a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/PhantomReferences.java">è™šå¼•ç”¨ç¤ºä¾‹</a>ä¸­çš„è™šå¼•ç”¨, ä½¿ç”¨åŒæ ·çš„JVMå‚æ•°å¯åŠ¨, å…¶ç»“æœå’Œå¼±å¼•ç”¨ç¤ºä¾‹éå¸¸ç›¸ä¼¼ã€‚å®é™…ä¸Š, full GC æš‚åœçš„æ¬¡æ•°ä¼šå°å¾—å¤š, åŸå› å‰é¢è¯´è¿‡, ä»–ä»¬æœ‰ä¸åŒçš„ç»ˆç»“æ–¹å¼ã€‚</p><p>å¦‚æœç¦ç”¨è™šå¼•ç”¨æ¸…ç†, å¢åŠ JVMå¯åŠ¨å‚æ•° (<code>-Dno.ref.clearing=true</code>), åˆ™å¯ä»¥çœ‹åˆ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4.180: [Full GC (Ergonomics)  57343K-&gt;57087K(61440K), 0.0879851 secs]</span><br><span class="line">4.269: [Full GC (Ergonomics)  57089K-&gt;57088K(61440K), 0.0973912 secs]</span><br><span class="line">4.366: [Full GC (Ergonomics)  57091K-&gt;57089K(61440K), 0.0948099 secs]</span><br></pre></td></tr></table></figure><p>main çº¿ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ <code>java.lang.OutOfMemoryError: Java heap space</code>.</p><p>ä½¿ç”¨è™šå¼•ç”¨æ—¶è¦å°å¿ƒè°¨æ…, å¹¶åŠæ—¶æ¸…ç†è™šå¯è¾¾å¯¹è±¡ã€‚å¦‚æœä¸æ¸…ç†, å¾ˆå¯èƒ½ä¼šå‘ç”Ÿ <a target="_blank" rel="noopener" href="https://plumbr.eu/outofmemory"><code>OutOfMemoryError</code></a>. è¯·ç›¸ä¿¡æˆ‘ä»¬çš„ç»éªŒæ•™è®­: å¤„ç† reference queue çš„çº¿ç¨‹ä¸­å¦‚æœæ²¡ catch ä½ exception , ç³»ç»Ÿå¾ˆå¿«å°±ä¼šè¢«æ•´æŒ‚äº†ã€‚</p><h3 id="ä½¿ç”¨éå¼ºå¼•ç”¨çš„å½±å“"><a href="#ä½¿ç”¨éå¼ºå¼•ç”¨çš„å½±å“" class="headerlink" title="ä½¿ç”¨éå¼ºå¼•ç”¨çš„å½±å“"></a>ä½¿ç”¨éå¼ºå¼•ç”¨çš„å½±å“</h3><p>å»ºè®®ä½¿ç”¨JVMå‚æ•° <code>-XX:+PrintReferenceGC</code> æ¥çœ‹çœ‹å„ç§å¼•ç”¨å¯¹GCçš„å½±å“. å¦‚æœå°†æ­¤å‚æ•°ç”¨äºå¯åŠ¨ <a target="_blank" rel="noopener" href="https://github.com/gvsmirnov/java-perv/blob/master/labs-8/src/main/java/ru/gvsmirnov/perv/labs/gc/WeakReferences.java">å¼±å¼•ç”¨ç¤ºä¾‹</a> , å°†ä¼šçœ‹åˆ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">2.173: [Full GC (Ergonomics) </span><br><span class="line">        2.234: [SoftReference, 0 refs, 0.0000151 secs]</span><br><span class="line">        2.234: [WeakReference, 2648 refs, 0.0001714 secs]</span><br><span class="line">        2.234: [FinalReference, 1 refs, 0.0000037 secs]</span><br><span class="line">        2.234: [PhantomReference, 0 refs, 0 refs, 0.0000039 secs]</span><br><span class="line">        2.234: [JNI Weak Reference, 0.0000027 secs]</span><br><span class="line">            [PSYoungGen: 9216K-&gt;8676K(10752K)] </span><br><span class="line">            [ParOldGen: 12115K-&gt;12115K(12288K)] </span><br><span class="line">            21331K-&gt;20792K(23040K), </span><br><span class="line">        [Metaspace: 3725K-&gt;3725K(1056768K)], </span><br><span class="line">        0.0766685 secs] </span><br><span class="line">    [Times: user=0.49 sys=0.01, real=0.08 secs] </span><br><span class="line">2.250: [Full GC (Ergonomics) </span><br><span class="line">        2.307: [SoftReference, 0 refs, 0.0000173 secs]</span><br><span class="line">        2.307: [WeakReference, 2298 refs, 0.0001535 secs]</span><br><span class="line">        2.307: [FinalReference, 3 refs, 0.0000043 secs]</span><br><span class="line">        2.307: [PhantomReference, 0 refs, 0 refs, 0.0000042 secs]</span><br><span class="line">        2.307: [JNI Weak Reference, 0.0000029 secs]</span><br><span class="line">            [PSYoungGen: 9215K-&gt;8747K(10752K)] </span><br><span class="line">            [ParOldGen: 12115K-&gt;12115K(12288K)] </span><br><span class="line">            21331K-&gt;20863K(23040K), </span><br><span class="line">        [Metaspace: 3725K-&gt;3725K(1056768K)], </span><br><span class="line">        0.0734832 secs] </span><br><span class="line">    [Times: user=0.52 sys=0.01, real=0.07 secs] </span><br><span class="line">2.323: [Full GC (Ergonomics) </span><br><span class="line">        2.383: [SoftReference, 0 refs, 0.0000161 secs]</span><br><span class="line">        2.383: [WeakReference, 1981 refs, 0.0001292 secs]</span><br><span class="line">        2.383: [FinalReference, 16 refs, 0.0000049 secs]</span><br><span class="line">        2.383: [PhantomReference, 0 refs, 0 refs, 0.0000040 secs]</span><br><span class="line">        2.383: [JNI Weak Reference, 0.0000027 secs]</span><br><span class="line">            [PSYoungGen: 9216K-&gt;8809K(10752K)] </span><br><span class="line">            [ParOldGen: 12115K-&gt;12115K(12288K)] </span><br><span class="line">            21331K-&gt;20925K(23040K), </span><br><span class="line">        [Metaspace: 3725K-&gt;3725K(1056768K)], </span><br><span class="line">        0.0738414 secs] </span><br><span class="line">    [Times: user=0.52 sys=0.01, real=0.08 secs]</span><br></pre></td></tr></table></figure><p>åªæœ‰ç¡®å®š GC å¯¹åº”ç”¨çš„ååé‡å’Œå»¶è¿Ÿé€ æˆå½±å“ä¹‹å, æ‰åº”è¯¥èŠ±å¿ƒæ€æ¥åˆ†æè¿™äº›ä¿¡æ¯, å®¡æŸ¥è¿™éƒ¨åˆ†æ—¥å¿—ã€‚é€šå¸¸æƒ…å†µä¸‹, æ¯æ¬¡GCæ¸…ç†çš„å¼•ç”¨æ•°é‡éƒ½æ˜¯å¾ˆå°‘çš„, å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸º <code>0</code>ã€‚å¦‚æœGC èŠ±äº†è¾ƒå¤šæ—¶é—´æ¥æ¸…ç†è¿™ç±»å¼•ç”¨, æˆ–è€…æ¸…é™¤äº†å¾ˆå¤šçš„æ­¤ç±»å¼•ç”¨, å°±éœ€è¦è¿›ä¸€æ­¥è§‚å¯Ÿå’Œåˆ†æäº†ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœç¨‹åºç¡®å®ç¢°åˆ°äº† <code>mis-</code>, <code>ab-</code> é—®é¢˜æˆ–è€…æ»¥ç”¨ weak, soft, phantom å¼•ç”¨, ä¸€èˆ¬éƒ½è¦ä¿®æ”¹ç¨‹åºçš„å®ç°é€»è¾‘ã€‚æ¯ä¸ªç³»ç»Ÿä¸ä¸€æ ·, å› æ­¤å¾ˆéš¾æä¾›é€šç”¨çš„æŒ‡å¯¼å»ºè®®, ä½†æœ‰ä¸€äº›å¸¸ç”¨çš„åŠæ³•:</p><ul><li><code>å¼±å¼•ç”¨</code>(<code>Weak references</code>) â€”â€” å¦‚æœæŸä¸ªå†…å­˜æ± çš„ä½¿ç”¨é‡å¢å¤§, é€ æˆäº†æ€§èƒ½é—®é¢˜, é‚£ä¹ˆå¢åŠ è¿™ä¸ªå†…å­˜æ± çš„å¤§å°(å¯èƒ½ä¹Ÿè¦å¢åŠ å †å†…å­˜çš„æœ€å¤§å®¹é‡)ã€‚å¦‚åŒç¤ºä¾‹ä¸­æ‰€çœ‹åˆ°çš„, å¢åŠ å †å†…å­˜çš„å¤§å°, ä»¥åŠå¹´è½»ä»£çš„å¤§å°, å¯ä»¥å‡è½»ç—‡çŠ¶ã€‚</li><li><code>è™šå¼•ç”¨</code>(<code>Phantom references</code>) â€”â€” è¯·ç¡®ä¿åœ¨ç¨‹åºä¸­è°ƒç”¨äº†è™šå¼•ç”¨çš„ <code>clear</code> æ–¹æ³•ã€‚ç¼–ç¨‹ä¸­å¾ˆå®¹æ˜“å¿½ç•¥æŸäº›è™šå¼•ç”¨, æˆ–è€…æ¸…ç†çš„é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§çš„é€Ÿåº¦, åˆæˆ–è€…æ¸…é™¤å¼•ç”¨é˜Ÿåˆ—çš„çº¿ç¨‹æŒ‚äº†, å°±ä¼šå¯¹GC é€ æˆå¾ˆå¤§å‹åŠ›, æœ€ç»ˆå¯èƒ½å¼•èµ· <a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/articles/javaee/index-jsp-136424.html"><code>OutOfMemoryError</code></a>ã€‚</li><li><code>è½¯å¼•ç”¨</code>(<code>Soft references</code>) â€”â€” å¦‚æœç¡®å®šé—®é¢˜çš„æ ¹æºæ˜¯è½¯å¼•ç”¨, å”¯ä¸€çš„è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ç¨‹åºæºç , æ”¹å˜å†…éƒ¨å®ç°é€»è¾‘ã€‚</li></ul><h2 id="å…¶ä»–ç¤ºä¾‹"><a href="#å…¶ä»–ç¤ºä¾‹" class="headerlink" title="å…¶ä»–ç¤ºä¾‹"></a>å…¶ä»–ç¤ºä¾‹</h2><p>å‰é¢ä»‹ç»äº†æœ€å¸¸è§çš„GCæ€§èƒ½é—®é¢˜ã€‚ä½†æˆ‘ä»¬å­¦åˆ°çš„å¾ˆå¤šåŸç†éƒ½æ²¡æœ‰å…·ä½“çš„åœºæ™¯æ¥å±•ç°ã€‚æœ¬èŠ‚ä»‹ç»ä¸€äº›ä¸å¸¸å‘ç”Ÿ, ä½†ä¹Ÿå¯èƒ½ä¼šç¢°åˆ°çš„é—®é¢˜ã€‚</p><h3 id="RMI-ä¸-GC"><a href="#RMI-ä¸-GC" class="headerlink" title="RMI ä¸ GC"></a>RMI ä¸ GC</h3><p>å¦‚æœç³»ç»Ÿæä¾›æˆ–è€…æ¶ˆè´¹ <a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/articles/javaee/index-jsp-136424.html">RMI</a> æœåŠ¡, åˆ™JVMä¼šå®šæœŸæ‰§è¡Œ full GC æ¥ç¡®ä¿æœ¬åœ°æœªä½¿ç”¨çš„å¯¹è±¡åœ¨å¦ä¸€ç«¯ä¹Ÿä¸å ç”¨ç©ºé—´. è®°ä½, å³ä½¿ä½ çš„ä»£ç ä¸­æ²¡æœ‰å‘å¸ƒ RMI æœåŠ¡, ä½†ç¬¬ä¸‰æ–¹æˆ–è€…å·¥å…·åº“ä¹Ÿå¯èƒ½ä¼šæ‰“å¼€ RMI ç»ˆç«¯. æœ€å¸¸è§çš„å…ƒå‡¶æ˜¯ JMX, å¦‚æœé€šè¿‡JMXè¿æ¥åˆ°è¿œç«¯, åº•å±‚åˆ™ä¼šä½¿ç”¨ RMI å‘å¸ƒæ•°æ®ã€‚</p><p>é—®é¢˜æ˜¯æœ‰å¾ˆå¤šä¸å¿…è¦çš„å‘¨æœŸæ€§ full GCã€‚æŸ¥çœ‹è€å¹´ä»£çš„ä½¿ç”¨æƒ…å†µ, ä¸€èˆ¬æ˜¯æ²¡æœ‰å†…å­˜å‹åŠ›, å…¶ä¸­è¿˜å­˜åœ¨å¤§é‡çš„ç©ºé—²åŒºåŸŸ, ä½† full GC å°±æ˜¯è¢«è§¦å‘äº†, ä¹Ÿå°±ä¼šæš‚åœæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ã€‚</p><p>è¿™ç§å‘¨æœŸæ€§è°ƒç”¨ <code>System.gc()</code> åˆ é™¤è¿œç¨‹å¼•ç”¨çš„è¡Œä¸º, æ˜¯åœ¨ <code>sun.rmi.transport.ObjectTable</code> ç±»ä¸­, é€šè¿‡ <code>sun.misc.GC.requestLatency(long gcInterval)</code> è°ƒç”¨çš„ã€‚</p><p>å¯¹è®¸å¤šåº”ç”¨æ¥è¯´, æ ¹æœ¬æ²¡å¿…è¦, ç”šè‡³å¯¹æ€§èƒ½æœ‰å®³ã€‚ ç¦æ­¢è¿™ç§å‘¨æœŸæ€§çš„ GC è¡Œä¸º, å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ JVM å‚æ•°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -Dsun.rmi.dgc.server.gcInterval=9223372036854775807L </span><br><span class="line">    -Dsun.rmi.dgc.client.gcInterval=9223372036854775807L </span><br><span class="line">    com.yourcompany.YourApplication</span><br></pre></td></tr></table></figure><p>è¿™è®© <code>Long.MAX_VALUE</code> æ¯«ç§’ä¹‹å, æ‰è°ƒç”¨ <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/7/docs/api/java/lang/System.html#gc()"><code>System.gc()</code></a>, å®é™…è¿è¡Œçš„ç³»ç»Ÿå¯èƒ½æ°¸è¿œéƒ½ä¸ä¼šè§¦å‘ã€‚</p><blockquote><p>ObjectTable.class</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private static final long gcInterval = </span><br><span class="line">((Long)AccessController.doPrivileged(</span><br><span class="line">    new GetLongAction(&quot;sun.rmi.dgc.server.gcInterval&quot;, 3600000L)</span><br><span class="line">    )).longValue();</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, é»˜è®¤å€¼ä¸º <code>3600000L</code>,ä¹Ÿå°±æ˜¯1å°æ—¶è§¦å‘ä¸€æ¬¡ Full GCã€‚</p><p>å¦ä¸€ç§æ–¹å¼æ˜¯æŒ‡å®šJVMå‚æ•° <code>-XX:+DisableExplicitGC</code>, ç¦æ­¢æ˜¾å¼åœ°è°ƒç”¨ <code>System.gc()</code>. ä½†æˆ‘ä»¬<strong>å¼ºçƒˆåå¯¹</strong> è¿™ç§æ–¹å¼, å› ä¸ºåŸ‹æœ‰åœ°é›·ã€‚</p><h3 id="JVMTI-tagging-ä¸-GC"><a href="#JVMTI-tagging-ä¸-GC" class="headerlink" title="JVMTI tagging ä¸ GC"></a>JVMTI tagging ä¸ GC</h3><p>å¦‚æœåœ¨ç¨‹åºå¯åŠ¨æ—¶æŒ‡å®šäº† Java Agent (<code>-javaagent</code>), agent å°±å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/7/docs/platform/jvmti/jvmti.html#Heap">JVMTI tagging</a> æ ‡è®°å †ä¸­çš„å¯¹è±¡ã€‚agent ä½¿ç”¨taggingçš„ç§ç§åŸå› æœ¬æ‰‹å†Œä¸è¯¦ç»†è®²è§£, ä½†å¦‚æœ tagging æ ‡è®°äº†å¤§é‡çš„å¯¹è±¡, å¾ˆå¯èƒ½ä¼šå¼•èµ· GC æ€§èƒ½é—®é¢˜, å¯¼è‡´å»¶è¿Ÿå¢åŠ , ä»¥åŠååé‡é™ä½ã€‚</p><p>é—®é¢˜å‘ç”Ÿåœ¨ native ä»£ç ä¸­, <code>JvmtiTagMap::do_weak_oops</code> åœ¨æ¯æ¬¡GCæ—¶, éƒ½ä¼šéå†æ‰€æœ‰æ ‡ç­¾(tag),å¹¶æ‰§è¡Œä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œã€‚æ›´å‘çš„æ˜¯, è¿™ç§æ“ä½œæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ã€‚</p><p>å¦‚æœå­˜åœ¨å¤§é‡çš„æ ‡ç­¾, å°±æ„å‘³ç€ GC æ—¶æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å·¥ä½œæ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„, GCæš‚åœæ—¶é—´å¯èƒ½ä¼šå¢åŠ ä¸€ä¸ªæ•°é‡çº§ã€‚</p><p>æ£€æŸ¥æ˜¯å¦å› ä¸º agent å¢åŠ äº†GCæš‚åœæ—¶é—´, å¯ä»¥ä½¿ç”¨è¯Šæ–­å‚æ•° <code>â€“XX:+TraceJVMTIObjectTagging</code>. å¯ç”¨è·Ÿè¸ªä¹‹å, å¯ä»¥ä¼°ç®—å‡ºå†…å­˜ä¸­ tag æ˜ å°„äº†å¤šå°‘ native å†…å­˜, ä»¥åŠéå†æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>å¦‚æœä½ ä¸æ˜¯ agent çš„ä½œè€…, é‚£ä¸€èˆ¬æ˜¯æä¸å®šè¿™ç±»é—®é¢˜çš„ã€‚é™¤äº†æBUGä¹‹å¤–ä½ ä»€ä¹ˆéƒ½åšä¸äº†. å¦‚æœå‘ç”Ÿäº†è¿™ç§æƒ…å†µ, è¯·å»ºè®®å‚å•†æ¸…ç†ä¸å¿…è¦çš„æ ‡ç­¾ã€‚</p><h3 id="å·¨æ— éœ¸å¯¹è±¡çš„åˆ†é…-Humongous-Allocations"><a href="#å·¨æ— éœ¸å¯¹è±¡çš„åˆ†é…-Humongous-Allocations" class="headerlink" title="å·¨æ— éœ¸å¯¹è±¡çš„åˆ†é…(Humongous Allocations)"></a>å·¨æ— éœ¸å¯¹è±¡çš„åˆ†é…(Humongous Allocations)</h3><p>å¦‚æœä½¿ç”¨ G1 åƒåœ¾æ”¶é›†ç®—æ³•, ä¼šäº§ç”Ÿä¸€ç§å·¨æ— éœ¸å¯¹è±¡å¼•èµ·çš„ GC æ€§èƒ½é—®é¢˜ã€‚</p><blockquote><p><strong>è¯´æ˜</strong>: åœ¨G1ä¸­, å·¨æ— éœ¸å¯¹è±¡æ˜¯æŒ‡æ‰€å ç©ºé—´è¶…è¿‡ä¸€ä¸ªå°å †åŒº(region) <code>50%</code> çš„å¯¹è±¡ã€‚</p></blockquote><p>é¢‘ç¹çš„åˆ›å»ºå·¨æ— éœ¸å¯¹è±¡, æ— ç–‘ä¼šé€ æˆGCçš„æ€§èƒ½é—®é¢˜, çœ‹çœ‹G1çš„å¤„ç†æ–¹å¼:</p><ul><li>å¦‚æœæŸä¸ª region ä¸­å«æœ‰å·¨æ— éœ¸å¯¹è±¡, åˆ™å·¨æ— éœ¸å¯¹è±¡åé¢çš„ç©ºé—´å°†ä¸ä¼šè¢«åˆ†é…ã€‚å¦‚æœæ‰€æœ‰å·¨æ— éœ¸å¯¹è±¡éƒ½è¶…è¿‡æŸä¸ªæ¯”ä¾‹, åˆ™æœªä½¿ç”¨çš„ç©ºé—´å°±ä¼šå¼•å‘å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</li><li>G1 æ²¡æœ‰å¯¹å·¨æ— éœ¸å¯¹è±¡è¿›è¡Œä¼˜åŒ–ã€‚è¿™åœ¨ JDK 8 ä»¥å‰æ˜¯ä¸ªç‰¹åˆ«æ£˜æ‰‹çš„é—®é¢˜ â€”â€” åœ¨ <a target="_blank" rel="noopener" href="https://bugs.openjdk.java.net/browse/JDK-8027959"><strong>Java 1.8u40</strong></a> ä¹‹å‰çš„ç‰ˆæœ¬ä¸­, å·¨æ— éœ¸å¯¹è±¡æ‰€åœ¨ region çš„å›æ”¶åªèƒ½åœ¨ full GC ä¸­è¿›è¡Œã€‚æœ€æ–°ç‰ˆæœ¬çš„ Hotspot JVM, åœ¨ marking é˜¶æ®µä¹‹åçš„ cleanup é˜¶æ®µä¸­é‡Šæ”¾å·¨æ— éœ¸åŒºé—´, æ‰€ä»¥è¿™ä¸ªé—®é¢˜åœ¨æ–°ç‰ˆæœ¬JVMä¸­çš„å½±å“å·²å¤§å¤§é™ä½ã€‚</li></ul><p>è¦ç›‘æ§æ˜¯å¦å­˜åœ¨å·¨æ— éœ¸å¯¹è±¡, å¯ä»¥æ‰“å¼€GCæ—¥å¿—, ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintGCDetails -XX:+PrintGCTimeStamps </span><br><span class="line">    -XX:+PrintReferenceGC -XX:+UseG1GC </span><br><span class="line">    -XX:+PrintAdaptiveSizePolicy -Xmx128m </span><br><span class="line">    MyClass</span><br></pre></td></tr></table></figure><p>GC æ—¥å¿—ä¸­å¯èƒ½ä¼šå‘ç°è¿™æ ·çš„éƒ¨åˆ†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0.106: [G1Ergonomics (Concurrent Cycles) </span><br><span class="line">       request concurrent cycle initiation, </span><br><span class="line">       reason: occupancy higher than threshold, </span><br><span class="line">       occupancy: 60817408 bytes, </span><br><span class="line">       allocation request: 1048592 bytes, </span><br><span class="line">       threshold: 60397965 bytes (45.00 %), </span><br><span class="line">       source: concurrent humongous allocation]</span><br><span class="line">0.106: [G1Ergonomics (Concurrent Cycles) </span><br><span class="line">       request concurrent cycle initiation, </span><br><span class="line">       reason: requested by GC cause, </span><br><span class="line">       GC cause: G1 Humongous Allocation]</span><br><span class="line">0.106: [G1Ergonomics (Concurrent Cycles) </span><br><span class="line">       initiate concurrent cycle, </span><br><span class="line">       reason: concurrent cycle initiation requested]</span><br><span class="line">0.106: [GC pause (G1 Humongous Allocation) </span><br><span class="line">       (young) (initial-mark) </span><br><span class="line">       0.106: [G1Ergonomics (CSet Construction) </span><br><span class="line">           start choosing CSet, </span><br><span class="line">           _pending_cards: 0, </span><br><span class="line">           predicted base </span><br><span class="line">           time: 10.00 ms, </span><br><span class="line">           remaining time: 190.00 ms, </span><br><span class="line">           target pause time: 200.00 ms]</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ—¥å¿—å°±æ˜¯è¯æ®, è¡¨æ˜ç¨‹åºä¸­ç¡®å®åˆ›å»ºäº†å·¨æ— éœ¸å¯¹è±¡. å¯ä»¥çœ‹åˆ°: <code>G1 Humongous Allocation</code> æ˜¯ GCæš‚åœçš„åŸå› ã€‚ å†çœ‹å‰é¢ä¸€ç‚¹çš„ <code>allocation request: 1048592 bytes</code> , å¯ä»¥å‘ç°ç¨‹åºè¯•å›¾åˆ†é…ä¸€ä¸ª <code>1,048,592</code> å­—èŠ‚çš„å¯¹è±¡, è¿™è¦æ¯”å·¨æ— éœ¸åŒºåŸŸ(<code>2MB</code>)çš„ <code>50%</code> å¤šå‡º 16 ä¸ªå­—èŠ‚ã€‚</p><p>ç¬¬ä¸€ç§è§£å†³æ–¹å¼, æ˜¯ä¿®æ”¹ region size , ä»¥ä½¿å¾—å¤§å¤šæ•°çš„å¯¹è±¡ä¸è¶…è¿‡ <code>50%</code>, ä¹Ÿå°±ä¸è¿›è¡Œå·¨æ— éœ¸å¯¹è±¡åŒºåŸŸçš„åˆ†é…ã€‚ region çš„é»˜è®¤å¤§å°åœ¨å¯åŠ¨æ—¶æ ¹æ®å †å†…å­˜çš„å¤§å°ç®—å‡ºã€‚ä½†ä¹Ÿå¯ä»¥æŒ‡å®šå‚æ•°æ¥è¦†ç›–é»˜è®¤è®¾ç½®, <code>-XX:G1HeapRegionSize=XX</code>ã€‚ æŒ‡å®šçš„ region size å¿…é¡»åœ¨ <code>1~32MB</code> ä¹‹é—´, è¿˜å¿…é¡»æ˜¯2çš„å¹‚ ã€2^10 &#x3D; 1024 &#x3D; 1KB; 2^20&#x3D;1MB; æ‰€ä»¥ region size åªèƒ½æ˜¯: <code>1m</code>,<code>2m</code>,<code>4m</code>,<code>8m</code>,<code>16m</code>,<code>32m</code>ã€‘ã€‚</p><p>è¿™ç§æ–¹å¼ä¹Ÿæœ‰å‰¯ä½œç”¨, å¢åŠ  region çš„å¤§å°ä¹Ÿå°±å˜ç›¸åœ°å‡å°‘äº† region çš„æ•°é‡, æ‰€ä»¥éœ€è¦è°¨æ…ä½¿ç”¨, æœ€å¥½è¿›è¡Œä¸€äº›æµ‹è¯•, çœ‹çœ‹æ˜¯å¦æ”¹å–„äº†ååé‡å’Œå»¶è¿Ÿã€‚</p><p>æ›´å¥½çš„æ–¹å¼éœ€è¦ä¸€äº›å·¥ä½œé‡, å¦‚æœå¯ä»¥çš„è¯, åœ¨ç¨‹åºä¸­é™åˆ¶å¯¹è±¡çš„å¤§å°ã€‚æœ€å¥½æ˜¯ä½¿ç”¨åˆ†æå™¨, å±•ç¤ºå‡ºå·¨æ— éœ¸å¯¹è±¡çš„ä¿¡æ¯, ä»¥åŠåˆ†é…æ—¶æ‰€åœ¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>JVMä¸Šè¿è¡Œçš„ç¨‹åºå¤šç§å¤šæ ·, å¯åŠ¨å‚æ•°ä¹Ÿæœ‰ä¸Šç™¾ä¸ª, å…¶ä¸­æœ‰å¾ˆå¤šä¼šå½±å“åˆ° GC, æ‰€ä»¥è°ƒä¼˜GCæ€§èƒ½çš„æ–¹æ³•ä¹Ÿæœ‰å¾ˆå¤šç§ã€‚</p><p>è¿˜æ˜¯é‚£å¥è¯, æ²¡æœ‰çœŸæ­£çš„é“¶å¼¹, èƒ½æ»¡è¶³æ‰€æœ‰çš„æ€§èƒ½è°ƒä¼˜æŒ‡æ ‡ã€‚ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯ä»‹ç»ä¸€äº›å¸¸è§çš„&#x2F;å’Œä¸å¸¸è§çš„ç¤ºä¾‹, è®©ä½ åœ¨ç¢°åˆ°ç±»ä¼¼é—®é¢˜æ—¶çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ã€‚æ·±å…¥ç†è§£GCçš„å·¥ä½œåŸç†, ç†Ÿç»ƒåº”ç”¨å„ç§å·¥å…·, å°±å¯ä»¥è¿›è¡ŒGCè°ƒä¼˜, æé«˜ç¨‹åºæ€§èƒ½ã€‚</p></article><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="èµèµä½œè€…"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>æ‰“èµä½œè€…</div><div class="reward-main"><div class="reward-all"><span class="reward-title">æ„Ÿè°¢ä½ èµäºˆæˆ‘å‰è¿›çš„åŠ›é‡</span><ul class="reward-group"><li class="reward-item"><a href="/img/wxpay.webp" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wxpay.webp" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.webp" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">èµèµè€…åå•</div><div class="reward-dec">å› ä¸ºä½ ä»¬çš„æ”¯æŒè®©æˆ‘æ„è¯†åˆ°å†™æ–‡ç« çš„ä»·å€¼ğŸ™</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« "><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://hexo.tryrun.top/posts/727d80c8.html"></div><div class="reward-dec">ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« </div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)&amp;url=https://hexo.tryrun.top/posts/727d80c8.html&amp;pic=https://cn.bing.com/th?id=OHR.MoonJellyDay_EN-US5774626244_UHD.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="å¤åˆ¶é“¾æ¥" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div><div class="post-tools-right"></div></div><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/JVM/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> JVM<span class="tagsPageCount">8</span></a><a class="post-meta__box__tags" href="/tags/%E4%BC%98%E5%8C%96/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> ä¼˜åŒ–<span class="tagsPageCount">9</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://cn.bing.com/th?id=OHR.MountSefton_ZH-CN4956097627_UHD.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload='this.media="all"'><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="post-copyright"><i class="anzhiyufont anzhiyu-icon-copyright"></i><div class="post-copyright__author"><a class="post-copyright__original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®" href="https://hexo.tryrun.top/posts/727d80c8.html">åŸåˆ›</a><a class="post-copyright-title"><span>å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)</span></a></div><div class="post-copyright-info-box"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span><span class="post-copyright-info"></span> <a class="link" href="https://hexo.tryrun.top">äº‘å°‘</a></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a class="link" href="https://hexo.tryrun.top/posts/727d80c8.html">https://hexo.tryrun.top/posts/727d80c8.html</a></span><span class="copy-button" onclick='rm.copyPageUrl("https://hexo.tryrun.top/posts/727d80c8.html")'><i class="anzhiyufont anzhiyu-icon-copy"></i></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://hexo.tryrun.top" target="_blank">äº‘é‡æœªæ™š</a>ï¼</span></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/4ae35017.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.PontRouge_EN-US8216026982_UHD.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ä¹ã€GC æ€§èƒ½ä¼˜åŒ– â€“ å¿«é€Ÿè§£è¯»GCæ—¥å¿—</div></div></a></div><div class="next-post pull-right"><a href="/posts/c219fcd0.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.KindredSpirits_EN-US5529252474_UHD.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ä¸ƒã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å·¥å…·ç¯‡)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/c219fcd0.html" title="ä¸ƒã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å·¥å…·ç¯‡)"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.KindredSpirits_EN-US5529252474_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-30</div><div class="title">ä¸ƒã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å·¥å…·ç¯‡)</div></div></a></div><div><a href="/posts/1cbf2ab0.html" title="å…­ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(åŸºç¡€ç¯‡)"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.MistyForest_EN-US5261676101_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-29</div><div class="title">å…­ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(åŸºç¡€ç¯‡)</div></div></a></div><div><a href="/posts/46b81885.html" title="äº”ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC ç®—æ³•(å®ç°ç¯‡)"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.Dargavs_EN-US4957085337_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-28</div><div class="title">äº”ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC ç®—æ³•(å®ç°ç¯‡)</div></div></a></div><div><a href="/posts/a63b36e1.html" title="å››ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC ç®—æ³•(åŸºç¡€ç¯‡)"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.RedFoxBlackForest_EN-US4823848176_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-27</div><div class="title">å››ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC ç®—æ³•(åŸºç¡€ç¯‡)</div></div></a></div><div><a href="/posts/2711940d0c.html" title="ä¸‰ã€GC æ€§èƒ½ä¼˜åŒ– â€“ Javaä¸­çš„åƒåœ¾æ”¶é›†"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.Bavljenac_EN-US8692148480_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-26</div><div class="title">ä¸‰ã€GC æ€§èƒ½ä¼˜åŒ– â€“ Javaä¸­çš„åƒåœ¾æ”¶é›†</div></div></a></div><div><a href="/posts/fb861b08.html" title="äºŒã€GC æ€§èƒ½ä¼˜åŒ– â€“ åƒåœ¾æ”¶é›†ç®€ä»‹"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.Neowise_EN-US4428390515_UHD.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-01-25</div><div class="title">äºŒã€GC æ€§èƒ½ä¼˜åŒ– â€“ åƒåœ¾æ”¶é›†ç®€ä»‹</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i> <span>è¯„è®º</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">åŒ¿åè¯„è®º</a></div><div class="comment-tips" id="comment-tips"><span>âœ… ä½ æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¯„è®ºä»¥è·å–æœ€ä½³å±•ç¤ºæ•ˆæœ</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="author-info-top"><div class="card-info-avatar"></div></div><div class="author-info__sayhi" id="author-info__sayhi"></div><h1 class="author-info__name">äº‘å°‘</h1><div class="author-info__description">ä¹Ÿè®¸ï¼Œè¿™é‡Œèƒ½æ‰¾åˆ°æ„Ÿå…´è¶£çš„å°ä¸œè¥¿å“¦</div><div class="banner-button-group"><a class="banner-button" onclick="pjax.loadUrl(&quot;/about/&quot;)"><span class="banner-button-text">äº†è§£æ›´å¤š</span><i class="anzhiyufont anzhiyu-icon-arrow-circle-right" style="font-size:1.5rem"></i></a></div><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/it985" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=2071916845@qq.com" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/300767383" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=2071916845&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><i class="anzhiyufont anzhiyu-icon-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content"><div id="welcome-info"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center/100% no-repeat"></div><div class="back face" style="background:url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center/100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>æ–‡ç« ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81GC-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E2%80%93-GC-%E8%B0%83%E4%BC%98-%E5%AE%9E%E6%88%98%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">å…«ã€GC æ€§èƒ½ä¼˜åŒ– â€“ GC è°ƒä¼˜(å®æˆ˜ç¯‡)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%88%86%E9%85%8D%E9%80%9F%E7%8E%87-High-Allocation-Rate"><span class="toc-number">1.1.</span> <span class="toc-text">é«˜åˆ†é…é€Ÿç‡(High Allocation Rate)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%B5%8B%E9%87%8F%E5%88%86%E9%85%8D%E9%80%9F%E7%8E%87"><span class="toc-number">1.1.1.</span> <span class="toc-text">å¦‚ä½•æµ‹é‡åˆ†é…é€Ÿç‡?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E9%80%9F%E7%8E%87%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">åˆ†é…é€Ÿç‡çš„æ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%88%86%E9%85%8D%E9%80%9F%E7%8E%87%E5%AF%B9JVM%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">1.1.4.</span> <span class="toc-text">é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.5.</span> <span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%97%A9%E6%8F%90%E5%8D%87-Premature-Promotion"><span class="toc-number">1.2.</span> <span class="toc-text">è¿‡æ—©æå‡(Premature Promotion)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%B5%8B%E9%87%8F%E6%8F%90%E5%8D%87%E9%80%9F%E7%8E%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">å¦‚ä½•æµ‹é‡æå‡é€Ÿç‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E9%80%9F%E7%8E%87%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">æå‡é€Ÿç‡çš„æ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%97%A9%E6%8F%90%E5%8D%87%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">1.2.4.</span> <span class="toc-text">è¿‡æ—©æå‡çš„å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.2.5.</span> <span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weak-Soft-%E5%8F%8A-Phantom-%E5%BC%95%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">Weak, Soft åŠ Phantom å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%BC%95%E7%94%A8%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.4.</span> <span class="toc-text">å¼±å¼•ç”¨çš„ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">1.5.</span> <span class="toc-text">ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9D%9E%E5%BC%BA%E5%BC%95%E7%94%A8%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">1.5.1.</span> <span class="toc-text">ä½¿ç”¨éå¼ºå¼•ç”¨çš„å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2"><span class="toc-number">1.5.2.</span> <span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.</span> <span class="toc-text">å…¶ä»–ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RMI-%E4%B8%8E-GC"><span class="toc-number">1.6.1.</span> <span class="toc-text">RMI ä¸ GC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVMTI-tagging-%E4%B8%8E-GC"><span class="toc-number">1.6.2.</span> <span class="toc-text">JVMTI tagging ä¸ GC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A8%E6%97%A0%E9%9C%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%86%E9%85%8D-Humongous-Allocations"><span class="toc-number">1.6.3.</span> <span class="toc-text">å·¨æ— éœ¸å¯¹è±¡çš„åˆ†é…(Humongous Allocations)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.4.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/f930f970.html" title="ä¸“æ æ±‡æ€»ï¼šJava 9 æ–°ç‰¹æ€§"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.MountSefton_ZH-CN4956097627_UHD.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ä¸“æ æ±‡æ€»ï¼šJava 9 æ–°ç‰¹æ€§"></a><div class="content"><a class="title" href="/posts/f930f970.html" title="ä¸“æ æ±‡æ€»ï¼šJava 9 æ–°ç‰¹æ€§">ä¸“æ æ±‡æ€»ï¼šJava 9 æ–°ç‰¹æ€§</a><time datetime="2021-06-27T15:14:05.000Z" title="å‘è¡¨äº 2021-06-27 23:14:05">2021-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b4cd1e40.html" title="ä¸“æ æ±‡æ€»ï¼šJava8 æ–°ç‰¹æ€§"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.MountSefton_ZH-CN4956097627_UHD.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ä¸“æ æ±‡æ€»ï¼šJava8 æ–°ç‰¹æ€§"></a><div class="content"><a class="title" href="/posts/b4cd1e40.html" title="ä¸“æ æ±‡æ€»ï¼šJava8 æ–°ç‰¹æ€§">ä¸“æ æ±‡æ€»ï¼šJava8 æ–°ç‰¹æ€§</a><time datetime="2021-06-08T09:51:16.000Z" title="å‘è¡¨äº 2021-06-08 17:51:16">2021-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3ec6e747.html" title="hexoä¸»é¢˜é­”æ”¹å¤‡å¿˜å½•"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.VosgesBioReserve_ZH-CN4762694302_UHD.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="hexoä¸»é¢˜é­”æ”¹å¤‡å¿˜å½•"></a><div class="content"><a class="title" href="/posts/3ec6e747.html" title="hexoä¸»é¢˜é­”æ”¹å¤‡å¿˜å½•">hexoä¸»é¢˜é­”æ”¹å¤‡å¿˜å½•</a><time datetime="2021-05-18T09:43:42.000Z" title="å‘è¡¨äº 2021-05-18 17:43:42">2021-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/718bea50.html" title="ä¸“æ æ±‡æ€»ï¼šJavaå¹¶å‘"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cn.bing.com/th?id=OHR.VosgesBioReserve_ZH-CN4762694302_UHD.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ä¸“æ æ±‡æ€»ï¼šJavaå¹¶å‘"></a><div class="content"><a class="title" href="/posts/718bea50.html" title="ä¸“æ æ±‡æ€»ï¼šJavaå¹¶å‘">ä¸“æ æ±‡æ€»ï¼šJavaå¹¶å‘</a><time datetime="2021-05-18T09:43:42.000Z" title="å‘è¡¨äº 2021-05-18 17:43:42">2021-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2ad0f5ed.html" title="Dubbo æºç åˆ†æ â€“ æœåŠ¡è°ƒç”¨è¿‡ç¨‹"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.bing.com/th?id=OHR.MandelaCamden_EN-GB1953677756_UHD.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Dubbo æºç åˆ†æ â€“ æœåŠ¡è°ƒç”¨è¿‡ç¨‹"></a><div class="content"><a class="title" href="/posts/2ad0f5ed.html" title="Dubbo æºç åˆ†æ â€“ æœåŠ¡è°ƒç”¨è¿‡ç¨‹">Dubbo æºç åˆ†æ â€“ æœåŠ¡è°ƒç”¨è¿‡ç¨‹</a><time datetime="2020-09-27T14:29:54.000Z" title="å‘è¡¨äº 2020-09-27 22:29:54">2020-09-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:2071916845@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="è¿”å›é¡¶éƒ¨" onclick="anzhiyu.scrollToDest(0,500)" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q1.qlogo.cn/g?b=qq&amp;nk=2071916845&amp;s=640" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/it985" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/300767383" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">æœåŠ¡</div><div class="footer-links"><a class="footer-item" title="51laç»Ÿè®¡" target="_blank" href="https://v6.51.la/">51laç»Ÿè®¡</a><a class="footer-item" title="åå¹´ä¹‹çº¦" target="_blank" href="https://www.foreverblog.cn/">åå¹´ä¹‹çº¦</a><a class="footer-item" title="å¼€å¾€" target="_blank" href="https://github.com/travellings-link/travellings">å¼€å¾€</a></div></div><div class="footer-group"><div class="footer-title">å¯¼èˆª</div><div class="footer-links"><a class="footer-item" title="å³åˆ»çŸ­æ–‡" target="_blank" href="/essay/">å³åˆ»çŸ­æ–‡</a><a class="footer-item" title="å‹é“¾æ–‡ç« " target="_blank" href="/fcircle/">å‹é“¾æ–‡ç« </a><a class="footer-item" title="ç•™è¨€æ¿" target="_blank" href="/comments/">ç•™è¨€æ¿</a></div></div><div class="footer-group"><div class="footer-title">åè®®</div><div class="footer-links"><a class="footer-item" title="å…è´£å£°æ˜" target="_blank" href="/disclaimer/">å…è´£å£°æ˜</a><a class="footer-item" title="éšç§åè®®" target="_blank" href="/privacy/">éšç§åè®®</a><a class="footer-item" title="Cookies" target="_blank" href="/cookies/">Cookies</a><a class="footer-item" title="ç‰ˆæƒåè®®" target="_blank" href="/copyright/">ç‰ˆæƒåè®®</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">å‹é“¾</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="æ¢ä¸€æ‰¹å‹æƒ…é“¾æ¥"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><div class="copyright">&copy;2018 - 2023 By äº‘å°‘</div><div id="workboard"><img class="workSituationImg boardsign" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/å®‰çŸ¥é±¼-ä¸Šç­æ‘¸é±¼ä¸­.svg" alt="è·ç¦»æœˆå…¥25kä¹Ÿå°±è¿˜å·®ä¸€ä¸ªå¤§ä½¬å¸¦æˆ‘~" title="è·ç¦»æœˆå…¥25kä¹Ÿå°±è¿˜å·®ä¸€ä¸ªå¤§ä½¬å¸¦æˆ‘~"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0" title="åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜" title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨å¤šå‰äº‘ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ" title="æœ¬ç«™ä½¿ç”¨å¤šå‰äº‘ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-å¤šå‰äº‘-3693F3.svg" alt="æœ¬ç«™ä½¿ç”¨å¤šå‰äº‘ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡" title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">Â©2023 - 2023 By&nbsp;<a class="footer-bar-link" href="https://hexo.tryrun.top" target="_blank" rel="external nofollow">äº‘é‡æœªæ™š</a></div></div></div><div class="footer-bar-right"><a class="footer-bar-link" href="/rss/" data-pjax-state="">è®¢é˜…</a><a class="footer-bar-link" href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" rel="noopener external nofollow noreferrer noopener">èµ£ICPå¤‡xxxxxxxxå·</a><a class="footer-bar-link cc" href="/copyright/" title="ccåè®®" data-pjax-state=""><i class="iconfont icon-a-Iconcopyright-line"></i><i class="iconfont icon-creative-commons-by-line"></i><i class="iconfont icon-creative-commons-nc-line"></i><i class="iconfont icon-creative-commons-nd-line"></i></a></div></div></div></footer></div></div></div><div id="sidebar"><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q1.qlogo.cn/g?b=qq&amp;nk=2071916845&amp;s=640" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">æ–‡ç« </div><div class="length-num">807</div></a><a href="/tags/" title="tag"><div class="headline">æ ‡ç­¾</div><div class="length-num">35</div></a><a href="/categories/" title="category"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>æœ›å››æ–¹</span></a><ul class="menus_item_child" style="left:-127px"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>å½’åæ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>å½’å››ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>ä¹¦ä¸­ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-fw fas fa-chart-bar faa-tada"></i> <span>ç»Ÿè®¡</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>å‹é“¾</span></a><ul class="menus_item_child" style="left:-79px"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>å››æ–¹å¥½å‹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>æˆ‘çš„</span></a><ul class="menus_item_child" style="left:-175px"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>éŸ³ä¹é¦†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i> <span>è¿½ç•ªé¡µ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i> <span>åˆ¹é‚£é—´</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i> <span>å°ç©ºè°ƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="fas fa-heart faa-tada"></i> <span>æˆ‘çš„è£…å¤‡</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span>å…³äº</span></a><ul class="menus_item_child" style="left:-127px"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i> <span>éšä¾¿é€›é€›</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/disclaimer/"><i class="fas fa-heart faa-tada"></i> <span>å…è´£å£°æ˜</span></a></li></ul></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch_commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="å¼€å…³å¼¹å¹•"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">æ’­æ”¾éŸ³ä¹</a><div id="console-music-bg"></div><meting-js id="60198" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶é€‰ä¸­æ–‡æœ¬</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>ç²˜è´´æ–‡æœ¬</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>å¼•ç”¨åˆ°è¯„è®º</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>å¤åˆ¶é“¾æ¥åœ°å€</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>å¤åˆ¶æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>ä¸‹è½½æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç«™å†…æœç´¢</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç™¾åº¦æœç´¢</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>æ’­æ”¾éŸ³ä¹</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>åˆ‡æ¢åˆ°ä¸Šä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=60198&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶æ­Œå</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>åšå®¢åˆ†ç±»</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶åœ°å€</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">å…³é—­çƒ­è¯„</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">æ·±è‰²æ¨¡å¼</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>è½‰ç‚ºç¹é«”</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET={CONFIG:{modules:"0124",background:"2",tmpColor:"FFFFFF",tmpSize:"16",cityColor:"FFFFFF",citySize:"16",aqiColor:"E8D87B",aqiSize:"16",weatherIconSize:"24",alertIconSize:"18",padding:"10px 10px 10px 10px",shadow:"0",language:"auto",borderRadius:"20",fixed:"true",vertical:"top",horizontal:"left",left:"20",top:"7.1",key:"df245676fb434a0691ead1c63341cd94"}}</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.4.0/source/js/utils.js"></script><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.4.0/source/js/main.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.6/translate/tw_cn.js"></script><script src="https://npm.elemecdn.com/@fancyapps/ui@4.0.31/dist/fancybox.umd.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><script>var meting_api="https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r"</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// æ¶ˆé™¤æ§åˆ¶å°æ‰“å°
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //åœ¨æ¢å¤å‰è¾“å‡ºæ—¥å¿—
  const grt = new Date("09/01/2018 00:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `æ¬¢è¿ä½¿ç”¨å®‰çŸ¥é±¼!`,
    `ç”Ÿæ´»æ˜æœ—, ä¸‡ç‰©å¯çˆ±`,
    "                __            .___       ________  ________  ________
      _______/  |_ __ __  __| _/__.__./   __   \/   __   \/  _____/
    /  ___/\   __\  |  \/ __ <   |  |\____    /\____    /   __  \ 
    \___ \  |  | |  |  / /_/ |\___  |   /    /    /    /\  |__\  \
    /____  > |__| |____/\____ |/ ____|  /____/    /____/  \_____  /
        \/                  \/\/                               \/            "
    "å·²ä¸Šçº¿",
    dnum,
    "å¤©",
  ];
  const ascll2 = [`NCC2-036`, `è°ƒç”¨å‰ç½®æ‘„åƒå¤´æ‹ç…§æˆåŠŸï¼Œè¯†åˆ«ä¸ºã€å°ç¬¨è›‹ã€‘.`, `Photo captured: `, `ğŸ¤ª`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c ä½ å¥½ï¼Œå°ç¬¨è›‹.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c âš¡ Powered by äº‘å°‘ %c ä½ æ­£åœ¨è®¿é—® äº‘å°‘ çš„åšå®¢.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c ä½ å·²æ‰“å¼€æ§åˆ¶å°.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c ä½ ç°åœ¨æ­£å¤„äºç›‘æ§ä¸­.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async>!function(){var e,t,n,r,a,i=new Date("09/01/2018 00:00:00"),o=new Date;setInterval((()=>{!function(){o=new Date,a=o.getHours();var l=(o-i)/1e3/60/60/24;e=Math.floor(l);var u=(o-i)/1e3/60/60-24*e;t=Math.floor(u),1==String(t).length&&(t="0"+t);var c=(o-i)/1e3/60-1440*e-60*t;n=Math.floor(c),1==String(n).length&&(n="0"+n);var m=(o-i)/1e3-86400*e-3600*t-60*n;r=Math.round(m),1==String(r).length&&(r="0"+r)}(),function(){if(!document.getElementById("footer"))return;let i="";if(a<18&&a>=9)i=`æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${e} å¤©<span id='runtime'> ${t} å°æ—¶ ${n} åˆ† ${r} ç§’ </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;else{let a=document.querySelector("#workboard .workSituationImg");a.src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/å®‰çŸ¥é±¼-ä¸‹ç­å•¦.svg",a.title="ä¸‹ç­äº†å°±è¯¥å¼€å¼€å¿ƒå¿ƒçš„ç©è€ï¼Œå˜¿å˜¿~",a.alt="ä¸‹ç­äº†å°±è¯¥å¼€å¼€å¿ƒå¿ƒçš„ç©è€ï¼Œå˜¿å˜¿~",i=`æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${e} å¤©<span id='runtime'> ${t} å°æ—¶ ${n} åˆ† ${r} ç§’ </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`}document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=i)}()}),1e3)}()</script><script src="https://npm.elemecdn.com/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js"></script><script src="https://npm.elemecdn.com/instantsearch.js@4.46.1/dist/instantsearch.production.min.js"></script><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.4.0/source/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(e.length){window.runMermaid=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach(((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,m="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent;mermaid.mermaidAPI.render(r,m,(e=>{d.insertAdjacentHTML("afterend",e)}))}))};const t=()=>{window.loadMermaid?runMermaid():getScript("https://npm.elemecdn.com/mermaid@9.1.7/dist/mermaid.min.js").then(runMermaid)};window.pjax?t():document.addEventListener("DOMContentLoaded",t)}})()</script><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.tryrun.top/",region:"",onCommentLoaded:function(){anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))},o=()=>{"object"!=typeof twikoo?getScript("https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/twikoo/1.4.18/twikoo.all.min.js").then(t):setTimeout(t,0)};o()})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick}</span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="æ²¡æœ‰è¯„è®º";let n=document.querySelector("#card-newest-comments .aside-list");n.innerHTML=t,window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.tryrun.top/",region:"",pageSize:6,includeReply:!0}).then((function(t){const n=t.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[å›¾ç‰‡]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[é“¾æ¥]")).replace(/<pre><code>.*?<\/pre>/gi,"[ä»£ç ]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").innerHTML="æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"}))};"object"==typeof twikoo?t():getScript("https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/twikoo/1.4.18/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)}))</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail="visitor@anheyu.com"</script><script>let titleTime,leaveTitle="w(ï¾ŸĞ”ï¾Ÿ)w ä¸è¦èµ°ï¼å†çœ‹çœ‹å˜›ï¼",backTitle="â™ª(^âˆ‡^*)æ¬¢è¿è‚¥æ¥ï¼",OriginTitile=document.title;document.addEventListener("visibilitychange",(function(){document.hidden?(document.title=leaveTitle,clearTimeout(titleTime)):(document.title=backTitle+OriginTitile,titleTime=setTimeout((function(){document.title=OriginTitile}),2e3))}))</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script>let rm={},aElements=document.getElementsByTagName("a");for(let e=0;e<aElements.length;e++){aElements[e].setAttribute("draggable","false");let t=aElements[e].getElementsByTagName("img");for(let e=0;e<t.length;e++)t[e].setAttribute("draggable","false")}rm.showRightMenu=function(e,t=0,n=0){console.info(t,n);let o=document.getElementById("rightMenu");o.style.top=t+"px",o.style.left=n+"px",e?(o.style.display="block",stopMaskScroll()):o.style.display="none"},rm.hideRightMenu=function(){rm.showRightMenu(!1),document.querySelector("#rightmenu-mask").style.display="none"};let rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight;rm.reloadrmSize=function(){rightMenu.style.visibility="hidden",rightMenu.style.display="block",rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight,rightMenu.style.visibility="visible"};let domhref="",domImgSrc="",globalEvent=null;var oncontextmenuFunction=function(e){if(document.body.clientWidth>768){let t=e.clientX+10,n=e.clientY;const o=document.querySelector(".rightMenuOther"),i=document.querySelector(".rightMenuPlugin"),c=document.querySelector("#menu-copytext"),l=document.querySelector("#menu-pastetext"),m=document.querySelector("#menu-commenttext"),d=document.querySelector("#menu-newwindow"),u=document.querySelector("#menu-newwindowimg"),r=document.querySelector("#menu-copylink"),a=document.querySelector("#menu-copyimg"),s=document.querySelector("#menu-downloadimg"),y=document.querySelector("#menu-search"),g=document.querySelector("#menu-searchBaidu"),h=document.querySelector("#menu-music-toggle"),p=document.querySelector("#menu-music-back"),w=document.querySelector("#menu-music-forward"),E=document.querySelector("#menu-music-playlist"),f=document.querySelector("#menu-music-copyMusicName");let k=e.target.href,v=e.target.currentSrc,b=!1;o.style.display="block",globalEvent=e,selectTextNow&&window.getSelection()?(b=!0,c.style.display="block",m.style.display="block",y.style.display="block",g.style.display="block"):(c.style.display="none",m.style.display="none",g.style.display="none",y.style.display="none"),k?(b=!0,d.style.display="block",r.style.display="block",domhref=k):(d.style.display="none",r.style.display="none"),v?(b=!0,a.style.display="block",s.style.display="block",u.style.display="block",document.getElementById("rightMenu").style.width="12rem",domImgSrc=v):(a.style.display="none",s.style.display="none",u.style.display="none"),"input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase()?(b=!0,l.style.display="block"):l.style.display="none";const B=document.querySelector("#nav-music");return B&&B.contains(e.target)?(b=!0,h.style.display="block",p.style.display="block",w.style.display="block",E.style.display="block",f.style.display="block"):(h.style.display="none",p.style.display="none",w.style.display="none",E.style.display="none",f.style.display="none"),b?(o.style.display="none",i.style.display="block"):i.style.display="none",rm.reloadrmSize(),t+rmWidth>window.innerWidth&&(t-=rmWidth+10),n+rmHeight>window.innerHeight&&(n-=n+rmHeight-window.innerHeight),rm.showRightMenu(!0,n,t),document.getElementById("rightmenu-mask").style.display="flex",!1}};function imageToBlob(e){const t=new Image,n=document.createElement("canvas"),o=n.getContext("2d");return t.crossOrigin="",t.src=e,new Promise((e=>{t.onload=function(){n.width=this.naturalWidth,n.height=this.naturalHeight,o.drawImage(this,0,0),n.toBlob((t=>{e(t)}),"image/png",.75)}}))}async function copyImage(e){const t=await imageToBlob(e),n=new ClipboardItem({"image/png":t});navigator.clipboard.write([n])}function stopMaskScroll(){if(document.getElementById("rightmenu-mask")){document.getElementById("rightmenu-mask").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),{passive:!0})}if(document.getElementById("rightMenu")){document.getElementById("rightMenu").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),{passive:!0})}}window.oncontextmenu=oncontextmenuFunction,rm.downloadimging=!1,rm.writeClipImg=function(e){console.log("æŒ‰ä¸‹å¤åˆ¶"),rm.hideRightMenu(),anzhiyu.snackbarShow("æ­£åœ¨ä¸‹è½½ä¸­ï¼Œè¯·ç¨å",!1,1e4),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout((function(){copyImage(e),anzhiyu.snackbarShow("å¤åˆ¶æˆåŠŸï¼å›¾ç‰‡å·²æ·»åŠ ç›²æ°´å°ï¼Œè¯·éµå®ˆç‰ˆæƒåè®®"),rm.downloadimging=!1}),"10000"))},rm.copyUrl=function(e){const t=document.createElement("input");t.id="copyVal",document.body.appendChild(t);const n=e;t.value=n,t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),t.remove()},rm.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},rm.copyPageUrl=function(e){e||(e=window.location.href),rm.copyUrl(e),anzhiyu.snackbarShow("å¤åˆ¶æœ¬é¡µé“¾æ¥åœ°å€æˆåŠŸ",!1,2e3),rm.hideRightMenu()},rm.sharePage=function(){window.location.href;rm.copyUrl(url),anzhiyu.snackbarShow("å¤åˆ¶æœ¬é¡µé“¾æ¥åœ°å€æˆåŠŸ",!1,2e3),rm.hideRightMenu()};var selectTextNow="";function selceText(){var e;e=document.selection?document.selection.createRange().text:window.getSelection().toString(),selectTextNow=""!==e?e:""}function replaceAll(e,t,n){return e.split(t).join(n)}function addRightMenuClickEvent(){document.getElementById("menu-backward").addEventListener("click",(function(){window.history.back(),rm.hideRightMenu()})),document.getElementById("menu-forward").addEventListener("click",(function(){window.history.forward(),rm.hideRightMenu()})),document.getElementById("menu-refresh").addEventListener("click",(function(){window.location.reload()})),document.getElementById("menu-top").addEventListener("click",(function(){anzhiyu.scrollToDest(0,500),rm.hideRightMenu()}));document.querySelectorAll(".menu-link").forEach((function(e){e.addEventListener("click",rm.hideRightMenu)})),document.getElementById("menu-darkmode").addEventListener("click",anzhiyu.switchDarkMode),document.getElementById("menu-home")&&document.getElementById("menu-home").addEventListener("click",(function(){window.location.href=window.location.origin})),document.getElementById("menu-randomPost").addEventListener("click",(function(){toRandomPost()})),document.getElementById("menu-commentBarrage").addEventListener("click",anzhiyu.switchCommentBarrage),document.getElementById("rightmenu-mask").addEventListener("click",rm.hideRightMenu),document.getElementById("rightmenu-mask").addEventListener("contextmenu",(function(e){rm.hideRightMenu(),e.preventDefault()})),document.getElementById("menu-copy").addEventListener("click",rm.copyPageUrl),document.getElementById("menu-pastetext").addEventListener("click",rm.pasteText),document.getElementById("menu-copytext").addEventListener("click",(function(){rm.rightmenuCopyText(selectTextNow),anzhiyu.snackbarShow("å¤åˆ¶æˆåŠŸï¼Œå¤åˆ¶å’Œè½¬è½½è¯·æ ‡æ³¨æœ¬æ–‡åœ°å€")})),document.getElementById("menu-commenttext").addEventListener("click",(function(){rm.rightMenuCommentText(selectTextNow)})),document.getElementById("menu-newwindow").addEventListener("click",(function(){window.open(domhref,"_blank"),rm.hideRightMenu()})),document.getElementById("menu-copylink").addEventListener("click",rm.copyLink),document.getElementById("menu-downloadimg").addEventListener("click",(function(){anzhiyu.downloadImage(domImgSrc,"anzhiyu")})),document.getElementById("menu-newwindowimg").addEventListener("click",(function(){window.open(domImgSrc,"_blank"),rm.hideRightMenu()})),document.getElementById("menu-copyimg").addEventListener("click",(function(){rm.writeClipImg(domImgSrc)})),document.getElementById("menu-searchBaidu").addEventListener("click",rm.searchBaidu),document.getElementById("menu-music-toggle").addEventListener("click",anzhiyu.musicToggle),document.getElementById("menu-music-back").addEventListener("click",anzhiyu.musicSkipBack),document.getElementById("menu-music-forward").addEventListener("click",anzhiyu.musicSkipForward),document.getElementById("menu-music-copyMusicName").addEventListener("click",(function(){rm.rightmenuCopyText(anzhiyu.musicGetName()),anzhiyu.snackbarShow("å¤åˆ¶æ­Œæ›²åç§°æˆåŠŸ",!1,3e3)}))}document.onmouseup=document.ondblclick=selceText,rm.readClipboard=function(){navigator.clipboard&&navigator.clipboard.readText().then((e=>rm.insertAtCaret(globalEvent.target,e)))},rm.insertAtCaret=function(e,t){const n=e.selectionStart,o=e.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(n||"0"==n){var i=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=i}else e.value+=t,e.focus()},rm.pasteText=function(){rm.readClipboard();rm.hideRightMenu()},rm.rightMenuCommentText=function(e){rm.hideRightMenu();var t=document.getElementById("post-comment").offsetTop;window.scrollTo(0,t-80),"undefined"!=e&&"null"!=e||(e="å¥½æ£’ï¼"),function t(){setTimeout((()=>{var n=document.getElementsByClassName("el-textarea__inner")[0];n||t();let o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!0);let i=replaceAll(e,"\n","\n> ");n.value="> "+i+"\n\n",n.dispatchEvent(o),n.focus(),n.setSelectionRange(-1,-1),document.getElementById("comment-tips")&&document.getElementById("comment-tips").classList.add("show")}),100)}()},rm.searchBaidu=function(){anzhiyu.snackbarShow("å³å°†è·³è½¬åˆ°ç™¾åº¦æœç´¢",!1,2e3),setTimeout((function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)}),"2000"),rm.hideRightMenu()},rm.copyLink=function(){rm.rightmenuCopyText(domhref),anzhiyu.snackbarShow("å·²å¤åˆ¶é“¾æ¥åœ°å€")},addRightMenuClickEvent()</script><script data-pjax>var themeColorMeta=document.querySelector('meta[name="theme-color"]'),pageHeaderEl=document.getElementById("page-header"),navMusicEl=document.getElementById("nav-music"),consoleEl=document.getElementById("console"),selectRandomSong=[],musicVolume=.8,changeMusicListFlag=!1,defaultPlayMusicList=[];document.getElementById("page-name").innerText=document.title.split(" | äº‘é‡æœªæ™š")[0],anzhiyu.initIndexEssay(),anzhiyu.changeTimeInEssay(),anzhiyu.removeBodyPaceClass(),anzhiyu.qrcodeCreate(),anzhiyu.changeTimeInAlbumDetail(),anzhiyu.reflashEssayWaterFall(),anzhiyu.sayhi(),anzhiyu.stopImgRightDrag(),anzhiyu.addNavBackgroundInit(),anzhiyu.setValueToBodyType(),anzhiyu.catalogActive(),anzhiyu.tagsPageActive(),anzhiyu.categoriesBarActive(),anzhiyu.topCategoriesBarScroll(),anzhiyu.switchRightClickMenuHotReview(),anzhiyu.getCustomPlayList(),anzhiyu.addEventListenerConsoleMusicList(!1),setTimeout((()=>{"function"==typeof addFriendLinksInFooter&&addFriendLinksInFooter()}),200)</script><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.1.4/icon/ali_iconfont_css.css"><script src="/js/1.min.js?1"></script><script src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script src="/js/lunar.min.js"></script><script src="/js/day.min.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://npm.elemecdn.com/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div></body></html>